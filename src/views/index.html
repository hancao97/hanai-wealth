<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Permissions-Policy" content="unload=()">
  <title>HANAI Â· WEALTH - æ™ºèƒ½æŠ•èµ„å†³ç­–å¹³å°</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    :root { 
      --bg: #f8fafc; 
      --card: #ffffff; 
      --text: #334155; 
      --accent: #3b82f6; 
      --border: rgba(0,0,0,0.1);
      --input-bg: rgba(255,255,255,0.8);
      --shadow: rgba(0,0,0,0.1);
      --primary: #1e40af;
      --secondary: #7c3aed;
      --gold: #f59e0b;
    }
    
    * { box-sizing: border-box; }
    
     html, body { 
       height: 100%; 
      margin: 0;
       font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
       background: linear-gradient(88deg, #dbeafe 0%, #e0e7ff 50%, var(--bg) 100%);
      color: var(--text);
     }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      margin-bottom: 30px;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .title-section {
      flex: 1;
    }
    
     .header h1 {
       margin: 0 0 10px;
       font-size: 42px;
       font-weight: 900;
       background: linear-gradient(135deg, #1e40af 0%, #3b82f6 30%, #7c3aed 60%, #f59e0b 100%);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       text-shadow: 0 4px 8px rgba(0,0,0,0.1);
       letter-spacing: 2px;
       text-transform: uppercase;
       position: relative;
       display: inline-block;
     }
     
     .header h1::before {
       content: '';
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       background: linear-gradient(135deg, #1e40af, #3b82f6, #7c3aed, #f59e0b);
       background-size: 300% 300%;
       animation: gradientShift 4s ease infinite;
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       z-index: -1;
     }
     
     @keyframes gradientShift {
       0% { background-position: 0% 50%; }
       50% { background-position: 100% 50%; }
       100% { background-position: 0% 50%; }
     }
     
     .header p {
      margin: 0;
       color: #64748b;
       font-size: 16px;
       font-weight: 500;
       letter-spacing: 1px;
     }
    
    .date-selector {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 200px;
    }
    
     .date-selector label {
       font-weight: 600;
       color: #1e40af;
       font-size: 14px;
       text-transform: uppercase;
       letter-spacing: 0.5px;
     }
    
     .date-select-input {
       padding: 12px 40px 12px 16px;
       background: white;
       border: 2px solid #d1d5db;
       border-radius: 12px;
       color: var(--text);
       font-size: 16px;
       font-weight: 600;
       transition: all 0.3s ease;
       box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     }
     
     .date-select-input:focus {
       outline: none;
       border-color: #3b82f6;
       box-shadow: 0 0 0 3px rgba(59,130,246,0.2), 0 4px 12px rgba(0,0,0,0.15);
       transform: translateY(-1px);
     }
     
     .date-select-input:hover {
       border-color: #3b82f6;
       transform: translateY(-1px);
     }
    
     .date-status {
       font-size: 12px;
       color: #64748b;
       font-weight: 500;
       padding: 4px 8px;
       background: #f1f5f9;
       border-radius: 6px;
       text-align: center;
       transition: all 0.2s ease;
     }
     
     .date-status.loading {
       color: #d97706;
       background: #fef3c7;
     }
     
     .date-status.success {
       color: #1e40af;
       background: #dbeafe;
     }
     
     .date-status.error {
       color: #dc2626;
       background: #fee2e2;
     }
    
     .filters {
       background: white;
       border: 1px solid var(--border);
      border-radius: 16px;
       padding: 24px;
       margin-bottom: 24px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.05);
     }
    
    .filter-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
     .filter-group label {
       font-weight: 500;
       color: #64748b;
       font-size: 13px;
     }
    
     .filter-input {
       padding: 8px 24px 8px 10px;
       background: white;
       border: 1px solid #d1d5db;
       border-radius: 8px;
      color: var(--text);
       font-size: 13px;
       transition: border-color 0.2s ease;
     }
     
     .filter-input:focus {
       outline: none;
       border-color: var(--accent);
       box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
     }
     
     .filter-input::placeholder {
       color: #9ca3af;
     }
    
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    
     .results-count {
       color: #64748b;
       font-size: 14px;
     }
     
     .loading {
       color: #d97706;
     }
    
     .table-container {
       background: white;
       border: 1px solid var(--border);
       border-radius: 16px;
       overflow: hidden;
       box-shadow: 0 4px 12px rgba(0,0,0,0.05);
     }
    
    .table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    
    .table th,
    .table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
      .table th:nth-child(1), .table td:nth-child(1) { width: 160px; } /* å…¬å¸ */
      .table th:nth-child(2), .table td:nth-child(2) { width: 180px; } /* è¡Œä¸š */
      .table th:nth-child(3), .table td:nth-child(3) { width: 80px; }  /* æ¿å— */
      .table th:nth-child(4), .table td:nth-child(4) { width: 90px; }  /* ä»·æ ¼ */
      .table th:nth-child(5), .table td:nth-child(5) { width: 90px; }  /* æ¶¨è·Œå¹… */
      .table th:nth-child(6), .table td:nth-child(6) { width: 80px; }  /* å¸‚ç›ˆç‡ */
      .table th:nth-child(7), .table td:nth-child(7) { width: 80px; }  /* è‚¡æ¯ç‡ */
      .table th:nth-child(8), .table td:nth-child(8) { width: 160px; }  /* åˆç†ä¼°å€¼ */
      .table th:nth-child(9), .table td:nth-child(9) { width: 90px; }  /* ä»·å€¼è¯„åˆ† */
      .table th:nth-child(10), .table td:nth-child(10) { width: 120px; } /* ä»·å€¼è¯„ä¼° */
      .table th:nth-child(11), .table td:nth-child(11) { width: 120px; } /* å¸‚å€¼ */
    
     .table th {
       background: #f8fafc;
       font-weight: 600;
       color: #475569;
       font-size: 13px;
       text-transform: uppercase;
       letter-spacing: 0.5px;
     }
    
    .table td {
      font-size: 14px;
    }
    
     .table tbody tr:hover {
       background: #f8fafc;
     }
     
     .table tbody tr.clickable {
      cursor: pointer;
       transition: all 0.2s ease;
     }
     
     .table tbody tr.clickable:hover {
       background: #e2e8f0;
       transform: translateY(-1px);
       box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     }
    
    .gf-valuation {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
      font-size: 12px;
    }
    
    .gf-0 { background: #6b7280; color: white; } /* æ•°æ®ä¸è¶³ - ç°è‰² */
    .gf-1 { background: #dc2626; color: white; } /* æ•°æ®é•¿ä¹…æœªæ›´æ–°ï¼Œè°¨æ…ä½¿ç”¨ - çº¢è‰² */
    .gf-2 { background: #dc2626; color: white; } /* ä»·å€¼é™·é˜±å«Œç–‘ - çº¢è‰² */
    .gf-3 { background: #059669; color: white; } /* ä¸¥é‡ä½ä¼° - æ·±ç»¿è‰² */
    .gf-4 { background: #10b981; color: white; } /* ä½ä¼° - ç»¿è‰² */
    .gf-5 { background: #3b82f6; color: white; } /* åˆç†èŒƒå›´ - è“è‰² */
    .gf-6 { background: #f59e0b; color: white; } /* é«˜ä¼° - æ©™è‰² */
    .gf-7 { background: #dc2626; color: white; } /* ä¸¥é‡é«˜ä¼° - çº¢è‰² */
    
    .price {
      font-weight: 600;
      color: var(--accent);
    }
    
    .symbol {
      font-family: 'Courier New', monospace;
      color: #94a3b8;
      font-size: 12px;
    }
    
    .board-tag {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
      font-size: 12px;
    }
    
    .board-main { background: #3b82f6; color: white; } /* ä¸»æ¿ - è“è‰² */
    .board-growth { background: #10b981; color: white; } /* åˆ›ä¸šæ¿ - ç»¿è‰² */
    .board-star { background: #f59e0b; color: white; } /* ç§‘åˆ›æ¿ - æ©™è‰² */
     .board-north { background: #8b5cf6; color: white; } /* åŒ—è¯ - ç´«è‰² */
     
     /* GFä»·å€¼æ ·å¼ */
     .gf-value {
       font-weight: 600;
       font-size: 13px;
       padding: 4px 8px;
       border-radius: 6px;
       display: inline-block;
       min-width: 60px;
       text-align: center;
       border: 1px solid transparent;
     }
     
     .gf-value.undervalued {
       background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
       color: #059669;
       border-color: #10b981;
       box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
     }
     
     .gf-value.overvalued {
       background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
       color: #dc2626;
       border-color: #ef4444;
       box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
     }
     
     .gf-value.no-data {
       background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
       color: #64748b;
       border-color: #94a3b8;
       font-style: italic;
     }
     
     .company-info {
       display: flex;
       flex-direction: column;
       gap: 2px;
     }
     
     .company-name {
       font-weight: 600;
       font-size: 13px;
       color: #1e40af;
       line-height: 1.2;
     }
     
     .company-symbol {
       font-size: 11px;
       color: #64748b;
       font-weight: 500;
     }
     
     /* Dashboard æ ·å¼ */
     .dashboard {
       margin: 24px 0;
     }
     
     .dashboard-row {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 24px;
       margin-bottom: 24px;
     }
     
     .dashboard-card {
       background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%);
       border: 1px solid rgba(148, 163, 184, 0.2);
       border-radius: 20px;
       padding: 32px;
       box-shadow: 0 20px 40px rgba(148, 163, 184, 0.15);
       position: relative;
       overflow: hidden;
     }
     
     .dashboard-card::before {
       content: '';
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       background: radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%), 
                   radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.03) 0%, transparent 50%);
       pointer-events: none;
     }
     
     .dashboard-card h3 {
       margin: 0 0 24px 0;
       font-size: 20px;
       font-weight: 800;
       text-align: center;
       position: relative;
       z-index: 1;
       background: linear-gradient(135deg, #1e293b 0%, #3b82f6 50%, #10b981 100%);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       text-shadow: 0 1px 2px rgba(0,0,0,0.1);
     }
     
     .chart-container {
       position: relative;
       z-index: 1;
       background: rgba(255, 255, 255, 0.8);
       border-radius: 16px;
       padding: 20px;
       backdrop-filter: blur(8px);
       border: 1px solid rgba(255, 255, 255, 0.6);
       box-shadow: 0 8px 16px rgba(0,0,0,0.05);
     }
     
     /* è‚¡æ¯ç‡ç»Ÿè®¡æ ·å¼ */
     .dividend-stats-container {
       background: linear-gradient(135deg, #f8fafc 0%, #ffffff 50%, #f1f5f9 100%);
       border: 1px solid rgba(148, 163, 184, 0.2);
       border-radius: 20px;
       padding: 32px;
       margin: 24px 0;
       box-shadow: 0 20px 40px rgba(148, 163, 184, 0.15);
       position: relative;
       overflow: hidden;
     }
     
     .dividend-stats-container::before {
       content: '';
       position: absolute;
       top: -50%;
       left: -50%;
       width: 200%;
       height: 200%;
       background: conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(59, 130, 246, 0.03) 60deg, transparent 120deg, rgba(16, 185, 129, 0.03) 180deg, transparent 240deg, rgba(239, 68, 68, 0.03) 300deg, transparent 360deg);
       animation: rotate 30s linear infinite;
       pointer-events: none;
     }
     
     @keyframes rotate {
       0% { transform: rotate(0deg); }
       100% { transform: rotate(360deg); }
     }
     
     .dividend-stats-title {
       margin: 0 0 24px 0;
       font-size: 22px;
       font-weight: 800;
       background: linear-gradient(135deg, #1e293b 0%, #3b82f6 50%, #10b981 100%);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       text-align: center;
       padding-bottom: 12px;
       border-bottom: 3px solid transparent;
       border-image: linear-gradient(90deg, transparent 0%, #3b82f6 50%, transparent 100%) 1;
       position: relative;
       z-index: 1;
       text-shadow: 0 2px 4px rgba(0,0,0,0.1);
     }
     
     .dividend-stats-grid {
       display: grid;
       grid-template-columns: repeat(6, 1fr);
       gap: 16px;
       position: relative;
       z-index: 1;
     }
     
     .dividend-stat-item {
       background: rgba(255, 255, 255, 0.95);
       backdrop-filter: blur(8px);
       border: 2px solid rgba(255, 255, 255, 0.3);
       border-radius: 16px;
       padding: 16px 12px;
       text-align: center;
       transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
       position: relative;
       overflow: hidden;
       box-shadow: 0 8px 16px rgba(0,0,0,0.08);
     }
     
     .dividend-stat-item::before {
       content: '';
       position: absolute;
       top: 0;
       left: -100%;
       width: 100%;
       height: 100%;
       background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
       transition: left 0.6s ease;
     }
     
     .dividend-stat-item:hover::before {
       left: 100%;
     }
     
     .dividend-stat-item:hover {
       transform: translateY(-6px) scale(1.03);
       box-shadow: 0 16px 32px rgba(0,0,0,0.15);
       border-color: rgba(255, 255, 255, 0.6);
     }
     
     .dividend-stat-item.clickable {
       cursor: pointer;
     }
     
     .dividend-stat-item.clickable:hover {
       transform: translateY(-8px) scale(1.05);
       box-shadow: 0 20px 40px rgba(0,0,0,0.2);
     }
     
     .dividend-stat-item.active {
       background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
       border-color: #1d4ed8;
       transform: translateY(-2px);
       box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
     }
     
     .dividend-stat-item.active .dividend-stat-value {
       color: white !important;
     }
     
     .dividend-stat-item.active .dividend-stat-label {
       color: rgba(255, 255, 255, 0.95) !important;
     }
     
     .dividend-stat-item.active .dividend-stat-desc {
       color: rgba(255, 255, 255, 0.8) !important;
     }
     
     .dividend-stat-item.active:hover {
       background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
       transform: translateY(-3px);
       box-shadow: 0 12px 32px rgba(59, 130, 246, 0.4);
     }
     
     .dividend-stat-value {
       font-size: 24px;
       font-weight: 800;
       margin-bottom: 8px;
       line-height: 1.1;
       background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       animation: numberPulse 3s ease-in-out infinite;
       position: relative;
       z-index: 1;
     }
     
     @keyframes numberPulse {
       0%, 100% { transform: scale(1); opacity: 1; }
       50% { transform: scale(1.05); opacity: 0.9; }
     }
     
     .dividend-stat-label {
       font-size: 12px;
       font-weight: 700;
       margin-bottom: 4px;
       color: #334155;
       line-height: 1.2;
       text-transform: uppercase;
       letter-spacing: 0.5px;
       position: relative;
       z-index: 1;
     }
     
     .dividend-stat-desc {
       font-size: 10px;
       color: #64748b;
       line-height: 1.3;
       font-weight: 500;
       position: relative;
       z-index: 1;
       opacity: 0.8;
     }
     
     /* ä¸åŒè‚¡æ¯ç‡æ°´å¹³çš„é¢œè‰² */
     .dividend-low { border-color: #94a3b8; background: #f8fafc; }
     .dividend-low .dividend-stat-value { color: #94a3b8; }
     
     .dividend-medium { border-color: #3b82f6; background: #dbeafe; }
     .dividend-medium .dividend-stat-value { color: #3b82f6; }
     
     .dividend-high { border-color: #10b981; background: #d1fae5; }
     .dividend-high .dividend-stat-value { color: #10b981; }
     
     .dividend-super-high { border-color: #f59e0b; background: #fef3c7; }
     .dividend-super-high .dividend-stat-value { color: #f59e0b; }
     
     .dividend-abnormal { border-color: #ef4444; background: #fee2e2; }
     .dividend-abnormal .dividend-stat-value { color: #ef4444; }
     
     .dividend-no-data { border-color: #6b7280; background: #f9fafb; }
     .dividend-no-data .dividend-stat-value { color: #6b7280; }
     
     /* å¸‚åœºæ¦‚è§ˆç»Ÿè®¡æ ·å¼ */
     .market-overview-container {
       background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
       border: none;
       border-radius: 20px;
       padding: 32px;
       margin: 24px 0;
       box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
       position: relative;
       overflow: hidden;
     }
     
     .market-overview-container::before {
       content: '';
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       background: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%, transparent);
       background-size: 30px 30px;
       pointer-events: none;
     }
     
     .market-overview-title {
       margin: 0 0 24px 0;
       font-size: 24px;
       font-weight: 800;
       color: white;
       text-align: center;
       text-shadow: 0 2px 4px rgba(0,0,0,0.3);
       position: relative;
       z-index: 1;
     }
     
     .market-overview-grid {
       display: grid;
       grid-template-columns: repeat(2, 1fr);
       gap: 24px;
       position: relative;
       z-index: 1;
     }
     
     .market-stat-card {
       background: rgba(255, 255, 255, 0.95);
       backdrop-filter: blur(10px);
       border: 1px solid rgba(255, 255, 255, 0.2);
       border-radius: 16px;
       padding: 24px;
       display: flex;
       align-items: center;
       gap: 20px;
       transition: all 0.3s ease;
       position: relative;
       overflow: hidden;
     }
     
     .market-stat-card::before {
       content: '';
       position: absolute;
       top: 0;
       left: -100%;
       width: 100%;
       height: 100%;
       background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
       transition: left 0.6s ease;
     }
     
     .market-stat-card:hover::before {
       left: 100%;
     }
     
     .market-stat-card:hover {
       transform: translateY(-8px) scale(1.02);
       box-shadow: 0 16px 32px rgba(0,0,0,0.2);
     }
     
     .market-stat-icon {
       width: 64px;
       height: 64px;
       border-radius: 16px;
       display: flex;
       align-items: center;
       justify-content: center;
       flex-shrink: 0;
       position: relative;
       z-index: 1;
     }
     
     .price-card .market-stat-icon {
       background: linear-gradient(135deg, #10b981 0%, #059669 100%);
       color: white;
       box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
     }
     
     .pe-card .market-stat-icon {
       background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
       color: white;
       box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
     }
     
     .market-stat-content {
       flex: 1;
       position: relative;
       z-index: 1;
     }
     
     .market-stat-value {
       font-size: 28px;
       font-weight: 800;
       margin-bottom: 4px;
       background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       line-height: 1.1;
       animation: pulse 2s ease-in-out infinite;
     }
     
     @keyframes pulse {
       0%, 100% { opacity: 1; }
       50% { opacity: 0.8; }
     }
     
     .market-stat-label {
       font-size: 14px;
       font-weight: 600;
       color: #64748b;
       margin-bottom: 8px;
       text-transform: uppercase;
       letter-spacing: 0.5px;
     }
     
     .market-stat-trend {
       display: flex;
       align-items: center;
       gap: 6px;
       font-size: 12px;
       color: #6b7280;
       font-weight: 500;
     }
     
     .trend-icon {
       font-size: 14px;
       animation: bounce 2s ease-in-out infinite;
     }
     
     @keyframes bounce {
       0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
       40% { transform: translateY(-4px); }
       60% { transform: translateY(-2px); }
     }
     
     .trend-text {
       opacity: 0.8;
     }
      
       .no-results {
       text-align: center;
       padding: 40px;
       color: #64748b;
     }
    
     .error {
       background: #fee2e2;
       border: 1px solid #fca5a5;
       color: #dc2626;
       padding: 12px 16px;
       border-radius: 8px;
       margin-bottom: 20px;
     }
    
    /* ä»ªè¡¨æ¿æ ·å¼ */
    .dashboard {
      margin-bottom: 24px;
    }
    
    .dashboard-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
     .dashboard-card {
       background: white;
       border: 1px solid #e2e8f0;
      border-radius: 16px;
       padding: 24px;
       box-shadow: 0 8px 32px rgba(0,0,0,0.1);
       position: relative;
       overflow: hidden;
     }
     
     .dashboard-card::before {
       content: '';
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       height: 3px;
       background: linear-gradient(90deg, #1e40af, #3b82f6, #7c3aed);
     }
     
     .dashboard-card h3 {
       margin: 0 0 16px;
       color: #1e40af;
       font-size: 18px;
       font-weight: 600;
       text-align: center;
     }
    
    .chart-container {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }
    
    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      font-size: 12px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }
    
     
     /* åˆ†é¡µæ ·å¼ */
     .pagination {
       display: flex;
       justify-content: center;
       align-items: center;
       gap: 8px;
       margin: 20px 0;
       flex-wrap: wrap;
     }
     
     .pagination-btn {
       padding: 8px 12px;
       background: white;
       border: 1px solid #d1d5db;
       border-radius: 6px;
       color: #374151;
       font-size: 14px;
      cursor: pointer;
       transition: all 0.2s ease;
       min-width: 40px;
       text-align: center;
     }
     
     .pagination-btn:hover {
       background: #f3f4f6;
       border-color: #9ca3af;
     }
     
     .pagination-btn.active {
       background: #3b82f6;
       border-color: #3b82f6;
       color: white;
     }
     
     .pagination-btn:disabled {
       background: #f9fafb;
       border-color: #e5e7eb;
       color: #9ca3af;
       cursor: not-allowed;
     }
     
     .pagination-info {
       color: #64748b;
       font-size: 14px;
       margin: 0 16px;
     }
    
    @media (max-width: 768px) {
      .container {
        max-width: 100%;
        padding: 16px;
      }
      
      .header-content {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      
      .title-section {
        order: 1;
      }
      
      .header h1 {
        font-size: 28px;
        letter-spacing: 1px;
      }
      
      .header p {
        font-size: 14px;
      }
      
      .date-selector {
        order: 2;
        min-width: auto;
      }
      
      .dashboard-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .dashboard-card {
        padding: 24px;
      }
      
      .dashboard-card h3 {
        font-size: 18px;
        margin-bottom: 16px;
      }
      
      .chart-container {
        padding: 12px;
      }
      
      .filter-row {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      
      .filter-input {
        padding: 6px 16px 6px 8px;
        font-size: 12px;
      }
      
      .filter-group label {
        font-size: 12px;
      }
      
      .pagination {
        gap: 4px;
        margin: 16px 0;
      }
      
      .pagination-btn {
        padding: 6px 8px;
        font-size: 12px;
        min-width: 32px;
      }
      
      .pagination-info {
        font-size: 12px;
        margin: 0 8px;
      }
      
      .table-container {
        overflow-x: auto;
        border-radius: 12px;
      }
      
      .dividend-stats-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      
      .dividend-stat-item {
        padding: 10px 6px;
      }
      
      .dividend-stat-value {
        font-size: 18px;
      }
      
      .dividend-stat-label {
        font-size: 10px;
      }
      
      .dividend-stat-desc {
        font-size: 8px;
      }
      
      .dividend-stats-title {
        font-size: 16px;
      }
      
      .dividend-stats-container {
        padding: 16px;
        margin: 16px 0;
      }
      
      .market-overview-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .market-overview-container {
        padding: 24px;
        margin: 16px 0;
      }
      
      .market-overview-title {
        font-size: 20px;
        margin-bottom: 16px;
      }
      
      .market-stat-card {
        padding: 20px;
        gap: 16px;
      }
      
      .market-stat-icon {
        width: 56px;
        height: 56px;
      }
      
      .market-stat-value {
        font-size: 24px;
      }
    }
    
    @media (max-width: 480px) {
      .filter-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .filter-input {
        padding: 5px 12px 5px 6px;
        font-size: 11px;
      }
      
      .filter-group label {
        font-size: 11px;
      }
      
      .dividend-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .dividend-stat-item {
        padding: 8px 4px;
      }
      
      .dividend-stat-value {
        font-size: 16px;
      }
      
      .dividend-stat-label {
        font-size: 9px;
      }
      
      .dividend-stat-desc {
        font-size: 7px;
      }
      
      .dividend-stats-container {
        padding: 12px;
        margin: 12px 0;
      }
      
      .market-overview-container {
        padding: 16px;
        margin: 12px 0;
      }
      
      .market-overview-title {
        font-size: 18px;
        margin-bottom: 12px;
      }
      
      .market-stat-card {
        padding: 16px;
        gap: 12px;
        flex-direction: column;
        text-align: center;
      }
      
      .market-stat-icon {
        width: 48px;
        height: 48px;
      }
      
      .market-stat-value {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="title-section">
           <h1>HANAI Â· WEALTH</h1>
           <p>æ™ºèƒ½è‚¡ç¥¨ä»·å€¼åˆ†æ Â· ä¸“ä¸šæŠ•èµ„å†³ç­–æ”¯æŒ</p>
        </div>
        <div class="date-selector">
          <label for="dateSelectTop">æ•°æ®æ—¥æœŸ</label>
          <select id="dateSelectTop" class="date-select-input">
            <!-- æ—¥æœŸé€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
          </select>
          <div class="date-status" id="dateStatus">é€‰æ‹©æ—¥æœŸä»¥æŸ¥çœ‹æ•°æ®</div>
        </div>
      </div>
    </div>
    
    <!-- ä»ªè¡¨æ¿ -->
    <div class="dashboard" id="dashboard" style="display: none;">
      <div class="dashboard-row">
        <!-- ä»·å€¼è¯„ä¼°åˆ†å¸ƒ -->
        <div class="dashboard-card">
          <h3>ä»·å€¼è¯„ä¼°åˆ†å¸ƒ</h3>
          <div class="chart-container">
            <div id="valuationChart" style="width: 100%; height: 300px;"></div>
          </div>
    </div>

        <!-- æ¶¨è·Œå¹…åˆ†å¸ƒ -->
        <div class="dashboard-card">
          <h3>æ¶¨è·Œå¹…åˆ†å¸ƒ</h3>
          <div class="chart-container">
            <div id="changeChart" style="width: 100%; height: 300px;"></div>
    </div>
        </div>
      </div>
      
      <!-- è‚¡æ¯ç‡ç»Ÿè®¡ -->
      <div class="dividend-stats-container">
        <h3 class="dividend-stats-title">è‚¡æ¯ç‡åˆ†å¸ƒç»Ÿè®¡</h3>
        <div class="dividend-stats-grid" id="dividendStatsGrid">
          <div class="dividend-stat-item dividend-low clickable" data-dividend="low" onclick="stockFilter.filterByDividend('low')">
            <div class="dividend-stat-value" id="lowDividendCount">0</div>
            <div class="dividend-stat-label">ä½è‚¡æ¯ (< 1%)</div>
            <div class="dividend-stat-desc">åˆ†çº¢å¾®å¼±ï¼Œå…¸å‹æˆé•¿è‚¡</div>
          </div>
          <div class="dividend-stat-item dividend-medium clickable" data-dividend="medium" onclick="stockFilter.filterByDividend('medium')">
            <div class="dividend-stat-value" id="mediumDividendCount">0</div>
            <div class="dividend-stat-label">ä¸­ç­‰è‚¡æ¯ (1-3%)</div>
            <div class="dividend-stat-desc">æ¥è¿‘å¸‚åœºå¹³å‡æ°´å¹³</div>
          </div>
          <div class="dividend-stat-item dividend-high clickable" data-dividend="high" onclick="stockFilter.filterByDividend('high')">
            <div class="dividend-stat-value" id="highDividendCount">0</div>
            <div class="dividend-stat-label">é«˜è‚¡æ¯ (3-5%)</div>
            <div class="dividend-stat-desc">é«˜äºå¤§ç›˜ï¼Œç¨³å®šç°é‡‘æµ</div>
          </div>
          <div class="dividend-stat-item dividend-super-high clickable" data-dividend="super-high" onclick="stockFilter.filterByDividend('super-high')">
            <div class="dividend-stat-value" id="superHighDividendCount">0</div>
            <div class="dividend-stat-label">è¶…é«˜è‚¡æ¯ (5-8%)</div>
            <div class="dividend-stat-desc">é“¶è¡Œç…¤ç‚­ç­‰ä¼ ç»Ÿè¡Œä¸š</div>
          </div>
          <div class="dividend-stat-item dividend-abnormal clickable" data-dividend="abnormal" onclick="stockFilter.filterByDividend('abnormal')">
            <div class="dividend-stat-value" id="abnormalDividendCount">0</div>
            <div class="dividend-stat-label">å¼‚å¸¸é«˜è‚¡æ¯ (> 8%)</div>
            <div class="dividend-stat-desc">éœ€è°¨æ…ï¼Œå¯èƒ½ä¸å¯æŒç»­</div>
          </div>
          <div class="dividend-stat-item dividend-no-data clickable" data-dividend="no-data" onclick="stockFilter.filterByDividend('no-data')">
            <div class="dividend-stat-value" id="noDividendDataCount">0</div>
            <div class="dividend-stat-label">æ— è‚¡æ¯æ•°æ®</div>
            <div class="dividend-stat-desc">ç¼ºå°‘åˆ†çº¢ä¿¡æ¯</div>
          </div>
        </div>
      </div>
      
      <!-- å¸‚åœºæ¦‚è§ˆç»Ÿè®¡ -->
      <div class="market-overview-container">
        <h3 class="market-overview-title">å¸‚åœºæ¦‚è§ˆ</h3>
        <div class="market-overview-grid">
          <div class="market-stat-card price-card">
            <div class="market-stat-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7h20l-10-5z"/>
                <path d="M2 17h20l-10 5-10-5z"/>
                <path d="M7 12h10"/>
              </svg>
            </div>
            <div class="market-stat-content">
              <div class="market-stat-value" id="avgPriceValue">Â¥0.00</div>
              <div class="market-stat-label">å¹³å‡è‚¡ä»·</div>
              <div class="market-stat-trend" id="avgPriceTrend">
                <span class="trend-icon">ğŸ“ˆ</span>
                <span class="trend-text">å¸‚åœºå‡ä»·</span>
              </div>
            </div>
          </div>
          
          <div class="market-stat-card pe-card">
            <div class="market-stat-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
            </div>
            <div class="market-stat-content">
              <div class="market-stat-value" id="avgPeValue">0.00</div>
              <div class="market-stat-label">å¹³å‡å¸‚ç›ˆç‡ï¼ˆæ’é™¤1000ä»¥ä¸Šå¼‚å¸¸å€¼å’ŒäºæŸä¼ä¸šï¼‰</div>
              <div class="market-stat-trend" id="avgPeTrend">
                <span class="trend-icon">âš¡</span>
                <span class="trend-text">ä¼°å€¼æ°´å¹³</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
    
    <div class="filters">
      <div class="filter-row">
        
        <div class="filter-group">
          <label for="companyFilter">å…¬å¸åç§°</label>
          <input 
            type="text" 
            id="companyFilter" 
            class="filter-input" 
            placeholder="è¾“å…¥å…¬å¸åç§°è¿›è¡Œç­›é€‰..."
          >
        </div>
        
        <div class="filter-group">
          <label for="valuationFilter">GFä¼°å€¼</label>
          <select id="valuationFilter" class="filter-input">
            <option value="">æ‰€æœ‰ä¼°å€¼</option>
            <option value="0">æ•°æ®ä¸è¶³</option>
            <option value="1">æ•°æ®é•¿ä¹…æœªæ›´æ–°ï¼Œè°¨æ…ä½¿ç”¨</option>
            <option value="2">ä»·å€¼é™·é˜±å«Œç–‘</option>
            <option value="3">ä¸¥é‡ä½ä¼°</option>
            <option value="4">ä½ä¼°</option>
            <option value="5">åˆç†èŒƒå›´</option>
            <option value="6">é«˜ä¼°</option>
            <option value="7">ä¸¥é‡é«˜ä¼°</option>
          </select>
        </div>
        
         <div class="filter-group">
           <label for="industryFilter">è¡Œä¸š</label>
           <select id="industryFilter" class="filter-input">
             <option value="">æ‰€æœ‰è¡Œä¸š</option>
           </select>
         </div>
         
         <div class="filter-group">
           <label for="boardFilter">æ¿å—</label>
           <select id="boardFilter" class="filter-input">
             <option value="">æ‰€æœ‰æ¿å—</option>
             <option value="ä¸»æ¿">ä¸»æ¿</option>
             <option value="åˆ›ä¸šæ¿">åˆ›ä¸šæ¿</option>
             <option value="ç§‘åˆ›æ¿">ç§‘åˆ›æ¿</option>
             <option value="åŒ—è¯">åŒ—è¯</option>
           </select>
         </div>
         
         <div class="filter-group">
           <label for="dividendFilter">è‚¡æ¯ç‡</label>
           <select id="dividendFilter" class="filter-input">
             <option value="">æ‰€æœ‰è‚¡æ¯ç‡</option>
             <option value="low">ä½è‚¡æ¯ (< 1%)</option>
             <option value="medium">ä¸­ç­‰è‚¡æ¯ (1-3%)</option>
             <option value="high">é«˜è‚¡æ¯ (3-5%)</option>
             <option value="super-high">è¶…é«˜è‚¡æ¯ (5-8%)</option>
             <option value="abnormal">å¼‚å¸¸é«˜è‚¡æ¯ (> 8%)</option>
             <option value="no-data">æ— è‚¡æ¯æ•°æ®</option>
           </select>
         </div>
      </div>
    </div>
    

    <div class="status-bar">
      <div class="results-count" id="resultsCount">åŠ è½½ä¸­...</div>
      <div id="loadingIndicator" class="loading" style="display: none;">æ­£åœ¨åŠ è½½æ•°æ®...</div>
    </div>
    
    <div id="errorMessage" class="error" style="display: none;"></div>
    
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>å…¬å¸</th>
            <th>è¡Œä¸š</th>
            <th>æ¿å—</th>
            <th>ä»·æ ¼</th>
            <th>æ¶¨è·Œå¹…</th>
            <th>å¸‚ç›ˆç‡</th>
            <th>è‚¡æ¯ç‡</th>
            <th>åˆç†ä¼°å€¼</th>
            <th>ä»·å€¼è¯„åˆ†</th>
            <th>ä»·å€¼è¯„ä¼°</th>
            <th>å¸‚å€¼</th>
          </tr>
        </thead>
        <tbody id="dataTable">
          <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </tbody>
      </table>
    </div>

     <!-- åˆ†é¡µæ§ä»¶ -->
     <div class="pagination" id="pagination" style="display: none;"></div>
 
     <div id="noResults" class="no-results" style="display: none;">
       <p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®</p>
     </div>
    </div>

  <script>
     class StockDataFilter {
       constructor() {
         this.allData = [];
         this.filteredData = [];
         this.availableDates = [];
         this.currentDate = null;
         this.currentPage = 1;
         this.pageSize = 100;
         this.totalPages = 0;
         
         this.initializeElements();
         this.loadDatesConfig();
       }
      
      initializeElements() {
        this.dateSelect = document.getElementById('dateSelectTop');
         this.companyFilter = document.getElementById('companyFilter');
         this.valuationFilter = document.getElementById('valuationFilter');
         this.industryFilter = document.getElementById('industryFilter');
         this.boardFilter = document.getElementById('boardFilter');
         this.dividendFilter = document.getElementById('dividendFilter');
        this.dataTable = document.getElementById('dataTable');
        this.resultsCount = document.getElementById('resultsCount');
        this.loadingIndicator = document.getElementById('loadingIndicator');
        this.errorMessage = document.getElementById('errorMessage');
         this.noResults = document.getElementById('noResults');
         this.dashboard = document.getElementById('dashboard');
         this.dateStatus = document.getElementById('dateStatus');
         this.pagination = document.getElementById('pagination');
        
        this.setupEventListeners();
      }
      
      setupEventListeners() {
        this.dateSelect.addEventListener('change', () => this.loadDataForDate());
         this.companyFilter.addEventListener('input', () => this.applyFilters());
         this.valuationFilter.addEventListener('change', () => this.applyFilters());
         this.industryFilter.addEventListener('change', () => this.applyFilters());
         this.boardFilter.addEventListener('change', () => this.applyFilters());
         this.dividendFilter.addEventListener('change', () => this.applyFilters());
      }
      
      async loadDatesConfig() {
        try {
          this.showLoading(true);
          console.log('æ­£åœ¨åŠ è½½æ—¥æœŸé…ç½®...');
          const response = await fetch('./dates.json');
          console.log('æ—¥æœŸé…ç½®å“åº”çŠ¶æ€:', response.status);
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const dates = await response.json();
          console.log('åŠ è½½åˆ°çš„æ—¥æœŸ:', dates);
          
          this.availableDates = dates.sort().reverse(); // æœ€æ–°æ—¥æœŸåœ¨å‰
          this.populateDateSelect();
          
          if (this.availableDates.length > 0) {
            // æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰æŒ‡å®šæ—¥æœŸ
            const urlParams = new URLSearchParams(window.location.search);
            const urlDate = urlParams.get('date');
            
            let selectedDate;
            if (urlDate && this.availableDates.includes(urlDate)) {
              // ä½¿ç”¨URLå‚æ•°ä¸­çš„æ—¥æœŸ
              selectedDate = urlDate;
            } else {
              // é»˜è®¤é€‰æ‹©æœ€æ–°æ—¥æœŸ
              selectedDate = this.availableDates[0];
            }
            
            this.currentDate = selectedDate;
            this.dateSelect.value = selectedDate;
            await this.loadDataForDate();
          }
        } catch (error) {
          console.error('åŠ è½½æ—¥æœŸé…ç½®å¤±è´¥:', error);
          this.showError('æ— æ³•åŠ è½½æ—¥æœŸé…ç½®: ' + error.message);
        } finally {
          this.showLoading(false);
        }
      }
      
      populateDateSelect() {
        this.dateSelect.innerHTML = '';
        this.availableDates.forEach(date => {
          const option = document.createElement('option');
          option.value = date;
          option.textContent = date;
          this.dateSelect.appendChild(option);
        });
        
        // ç¡®ä¿æ—¥æœŸé€‰æ‹©å™¨ä¸èƒ½ä¸ºç©º
        this.dateSelect.required = true;
      }
      
      async loadDataForDate() {
        const selectedDate = this.dateSelect.value;
        if (!selectedDate) return;
        
        try {
          this.showLoading(true);
          this.updateDateStatus('åŠ è½½ä¸­...', 'loading');
          this.currentDate = selectedDate;
          
          const response = await fetch(`./assets/${selectedDate}.json`);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
            this.allData = await response.json();
            this.updateDateStatus(`${selectedDate} æ•°æ®å·²åŠ è½½ (${this.allData.length.toLocaleString()}æ¡)`, 'success');
            this.populateIndustryOptions();
            this.updateDashboard();
            this.applyFilters();
        } catch (error) {
          this.showError(`æ— æ³•åŠ è½½ ${selectedDate} çš„æ•°æ®: ${error.message}`);
          this.updateDateStatus(`åŠ è½½å¤±è´¥`, 'error');
          this.allData = [];
          this.applyFilters();
        } finally {
          this.showLoading(false);
        }
      }
      
      updateDateStatus(message, type = '') {
        this.dateStatus.textContent = message;
        this.dateStatus.className = `date-status ${type}`;
      }
      
      
      updateDividendStats() {
        if (!this.allData || this.allData.length === 0) {
          return;
        }
        
        // ç»Ÿè®¡å„ä¸ªè‚¡æ¯ç‡æ°´å¹³çš„æ•°é‡
        let lowDividend = 0;         // < 1%
        let mediumDividend = 0;      // 1% - 3%
        let highDividend = 0;        // 3% - 5%
        let superHighDividend = 0;   // 5% - 8%
        let abnormalDividend = 0;    // > 8%
        let noDividendData = 0;      // æ— æ•°æ®
        
        this.allData.forEach(item => {
          const yield_value = item.yield;
          
          // æ£€æŸ¥æ˜¯å¦æœ‰yieldå€¼
          if (yield_value === null || yield_value === undefined || yield_value === '' || yield_value === 0) {
            noDividendData++;
            return;
          }
          
            // è½¬æ¢ä¸ºæ•°å­—
            const numYield = parseFloat(yield_value);
          
          // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
          if (isNaN(numYield) || numYield < 0) {
            noDividendData++;
          } else if (numYield < 1) {
            lowDividend++;
          } else if (numYield < 3) {
            mediumDividend++;
          } else if (numYield < 5) {
            highDividend++;
          } else if (numYield <= 8) {
            superHighDividend++;
          } else {
            abnormalDividend++;
          }
        });
        
        // æ›´æ–°DOM - ä½¿ç”¨åŠ¨ç”»æ•ˆæœ
        const updateElementWithAnimation = (id, value) => {
          const element = document.getElementById(id);
          if (element) {
            this.animateValue(id, 0, value, 1500, (val) => Math.round(val).toLocaleString());
          }
        };
        
        updateElementWithAnimation('lowDividendCount', lowDividend);
        updateElementWithAnimation('mediumDividendCount', mediumDividend);
        updateElementWithAnimation('highDividendCount', highDividend);
        updateElementWithAnimation('superHighDividendCount', superHighDividend);
        updateElementWithAnimation('abnormalDividendCount', abnormalDividend);
        updateElementWithAnimation('noDividendDataCount', noDividendData);
      }
      
      // æ›´æ–°å¸‚åœºæ¦‚è§ˆç»Ÿè®¡
      updateMarketOverview() {
        if (!this.allData || this.allData.length === 0) {
          return;
        }
        
        let totalPrice = 0;
        let priceCount = 0;
        let totalPE = 0;
        let peCount = 0;
        
        this.allData.forEach(item => {
          // è®¡ç®—å¹³å‡è‚¡ä»·
          const price = parseFloat(item.price?.replace('Â¥', ''));
          if (!isNaN(price) && price > 0) {
            totalPrice += price;
            priceCount++;
          }
          
          // è®¡ç®—å¹³å‡å¸‚ç›ˆç‡
          const pe = parseFloat(item.pettm);
          if (!isNaN(pe) && pe < 1000) { // æ’é™¤å¼‚å¸¸å€¼
            totalPE += pe;
            peCount++;
          }
        });
        
        // è®¡ç®—å¹³å‡å€¼
        const avgPrice = priceCount > 0 ? totalPrice / priceCount : 0;
        const avgPE = peCount > 0 ? totalPE / peCount : 0;
        
        // ä½¿ç”¨åŠ¨ç”»æ›´æ–°æ•°å€¼
        this.animateValue('avgPriceValue', 0, avgPrice, 2000, (value) => `Â¥${value.toFixed(2)}`);
        this.animateValue('avgPeValue', 0, avgPE, 2000, (value) => value.toFixed(2));
        
        // æ›´æ–°è¶‹åŠ¿ä¿¡æ¯
        this.updateTrendInfo(avgPrice, avgPE);
      }
      
      // æ•°å€¼åŠ¨ç”»æ•ˆæœ
      animateValue(elementId, start, end, duration, formatter) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const startTime = performance.now();
        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // ä½¿ç”¨easeOutQuartç¼“åŠ¨å‡½æ•°
          const easeProgress = 1 - Math.pow(1 - progress, 4);
          const currentValue = start + (end - start) * easeProgress;
          
          element.textContent = formatter(currentValue);
          
          if (progress < 1) {
            requestAnimationFrame(animate);
          }
        };
        
        requestAnimationFrame(animate);
      }
      
      // æ›´æ–°è¶‹åŠ¿ä¿¡æ¯
      updateTrendInfo(avgPrice, avgPE) {
        const priceLevel = this.getPriceLevel(avgPrice);
        const peLevel = this.getPELevel(avgPE);
        
        const priceTrend = document.getElementById('avgPriceTrend');
        const peTrend = document.getElementById('avgPeTrend');
        
        if (priceTrend) {
          priceTrend.innerHTML = `
            <span class="trend-icon">${priceLevel.icon}</span>
            <span class="trend-text">${priceLevel.text}</span>
          `;
        }
        
        if (peTrend) {
          peTrend.innerHTML = `
            <span class="trend-icon">${peLevel.icon}</span>
            <span class="trend-text">${peLevel.text}</span>
          `;
        }
      }
      
      // è·å–è‚¡ä»·æ°´å¹³æè¿°
      getPriceLevel(price) {
        if (price < 10) return { icon: 'ğŸ“‰', text: 'ä½ä»·è‚¡ç¥¨' };
        if (price < 30) return { icon: 'ğŸ“Š', text: 'ä¸­ç­‰ä»·ä½' };
        if (price < 100) return { icon: 'ğŸ“ˆ', text: 'è¾ƒé«˜ä»·ä½' };
        return { icon: 'ğŸ’', text: 'é«˜ä»·è‚¡ç¥¨' };
      }
      
      // è·å–å¸‚ç›ˆç‡æ°´å¹³æè¿°
      getPELevel(pe) {
        if (pe < 15) return { icon: 'ğŸ’°', text: 'ä½ä¼°å€¼' };
        if (pe < 25) return { icon: 'âš–ï¸', text: 'åˆç†ä¼°å€¼' };
        if (pe < 50) return { icon: 'âš¡', text: 'è¾ƒé«˜ä¼°å€¼' };
        return { icon: 'ğŸ”¥', text: 'é«˜ä¼°å€¼' };
      }
      
      // æ·»åŠ dashboardåŠ è½½åŠ¨ç”»
      addDashboardLoadingAnimation() {
        // ä¸ºæ‰€æœ‰ç»Ÿè®¡å®¹å™¨æ·»åŠ å…¥åœºåŠ¨ç”»
        const containers = [
          document.querySelector('.dashboard'),
          document.querySelector('.dividend-stats-container'),
          document.querySelector('.market-overview-container')
        ];
        
        containers.forEach((container, index) => {
          if (container) {
            container.style.opacity = '0';
            container.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
              container.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
              container.style.opacity = '1';
              container.style.transform = 'translateY(0)';
            }, index * 200);
          }
        });
        
        // ä¸ºç»Ÿè®¡å¡ç‰‡æ·»åŠ ä¾æ¬¡å…¥åœºåŠ¨ç”»
        const dividendCards = document.querySelectorAll('.dividend-stat-item');
        dividendCards.forEach((card, index) => {
          card.style.opacity = '0';
          card.style.transform = 'translateY(20px) scale(0.9)';
          
          setTimeout(() => {
            card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0) scale(1)';
          }, 500 + index * 100);
        });
        
        // ä¸ºå¸‚åœºæ¦‚è§ˆå¡ç‰‡æ·»åŠ åŠ¨ç”»
        const marketCards = document.querySelectorAll('.market-stat-card');
        marketCards.forEach((card, index) => {
          card.style.opacity = '0';
          card.style.transform = 'translateX(-30px) rotateY(-15deg)';
          
          setTimeout(() => {
            card.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
            card.style.opacity = '1';
            card.style.transform = 'translateX(0) rotateY(0deg)';
          }, 800 + index * 300);
        });
      }
      
      // è·å–è‚¡æ¯ç‡åˆ†ç±»
      getDividendCategory(yield_value) {
        // æ£€æŸ¥æ˜¯å¦æœ‰yieldå€¼
        if (yield_value === null || yield_value === undefined || yield_value === '' || yield_value === 0) {
          return 'no-data';
        }
        
        // è½¬æ¢ä¸ºæ•°å­—
        const numYield = parseFloat(yield_value);
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
        if (isNaN(numYield) || numYield < 0) {
          return 'no-data';
        } else if (numYield < 1) {
          return 'low';
        } else if (numYield < 3) {
          return 'medium';
        } else if (numYield < 5) {
          return 'high';
        } else if (numYield <= 8) {
          return 'super-high';
        } else {
          return 'abnormal';
        }
      }
      
      // è‚¡æ¯ç‡ç­›é€‰åŠŸèƒ½
      filterByDividend(dividend) {
        if (this.dividendFilter.value === dividend) {
          // å¦‚æœå·²ç»é€‰æ‹©äº†è¯¥è‚¡æ¯ç‡ï¼Œåˆ™æ¸…é™¤ç­›é€‰
          this.dividendFilter.value = '';
        } else {
          // è®¾ç½®è‚¡æ¯ç‡ç­›é€‰
          this.dividendFilter.value = dividend;
        }
        this.applyFilters();
        this.updateDividendStatActiveState();
      }
      
      // æ›´æ–°è‚¡æ¯ç‡ç»Ÿè®¡å¡ç‰‡çš„æ¿€æ´»çŠ¶æ€
      updateDividendStatActiveState() {
        const dividendItems = document.querySelectorAll('.dividend-stat-item[data-dividend]');
        const selectedDividend = this.dividendFilter ? this.dividendFilter.value : '';
        
        dividendItems.forEach(item => {
          const dividend = item.getAttribute('data-dividend');
          if (dividend === selectedDividend) {
            item.classList.add('active');
          } else {
            item.classList.remove('active');
          }
        });
      }
      
      // æ ¹æ®è‚¡ç¥¨ä»£ç æ£€æµ‹æ¿å—ç±»å‹
      detectStockBoard(symbol) {
        if (!symbol || typeof symbol !== 'string') {
          return 'ä¸»æ¿';
        }
        
        const code = symbol.trim();
        
        // ä¸»æ¿ï¼š000/001/002/003/600/601/603/605 å¼€å¤´
        if (/^(000|001|002|003|600|601|603|605)/.test(code)) {
          return 'ä¸»æ¿';
        }
        
        // åˆ›ä¸šæ¿ï¼š300/301 å¼€å¤´  
        if (/^(300|301)/.test(code)) {
          return 'åˆ›ä¸šæ¿';
        }
        
        // ç§‘åˆ›æ¿ï¼š688 å¼€å¤´
        if (/^688/.test(code)) {
          return 'ç§‘åˆ›æ¿';
        }
        
        // åŒ—è¯ï¼š43/83/87/92 å¼€å¤´
        if (/^(43|83|87|92)/.test(code)) {
          return 'åŒ—è¯';
        }
        
        // æœªçŸ¥æƒ…å†µï¼Œè®¡å…¥ä¸»æ¿
        return 'ä¸»æ¿';
      }
      
      // è·å–æ¿å—å¯¹åº”çš„CSSç±»
      getBoardClass(board) {
        const classMap = {
          'ä¸»æ¿': 'board-main',
          'åˆ›ä¸šæ¿': 'board-growth',
          'ç§‘åˆ›æ¿': 'board-star',
          'åŒ—è¯': 'board-north'
        };
        return classMap[board] || 'board-main';
      }
      
      applyFilters() {
        // å¦‚æœå…³é”®ç­›é€‰å™¨å…ƒç´ è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œè·³è¿‡ç­›é€‰
        if (!this.companyFilter || !this.valuationFilter || !this.dividendFilter) {
          return;
        }
        
        let filtered = [...this.allData];
        
        // å…¬å¸åç§°ç­›é€‰
        const companyQuery = this.companyFilter.value.trim().toLowerCase();
        if (companyQuery) {
          filtered = filtered.filter(item => 
            item.company && item.company.toLowerCase().includes(companyQuery)
          );
        }
        
        // GFä¼°å€¼ç­›é€‰
        const valuationValue = this.valuationFilter.value;
        if (valuationValue) {
          const targetValuation = Number(valuationValue);
          filtered = filtered.filter(item => {
            const valuation = item.gf_valuation;
            return valuation === targetValuation;
          });
        }
        
         // è¡Œä¸šç­›é€‰
         if (this.industryFilter) {
           const industryValue = this.industryFilter.value;
           if (industryValue) {
             filtered = filtered.filter(item => {
               return item.industry === industryValue;
             });
           }
         }
         
         // æ¿å—ç­›é€‰
         if (this.boardFilter) {
           const boardValue = this.boardFilter.value;
           if (boardValue) {
             filtered = filtered.filter(item => {
               const board = item.board || this.detectStockBoard(item.symbol);
               return board === boardValue;
             });
           }
         }
         
         // è‚¡æ¯ç‡ç­›é€‰
         if (this.dividendFilter) {
           const dividendValue = this.dividendFilter.value;
           if (dividendValue) {
             filtered = filtered.filter(item => {
               const yield_value = item.yield;
               const category = this.getDividendCategory(yield_value);
               return category === dividendValue;
             });
           }
         }
        
         this.filteredData = filtered;
         this.currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
         this.renderTable();
         this.updateResultsCount();
         this.renderPagination();
         this.updateDividendStatActiveState();
      }
      
       renderTable() {
         if (this.filteredData.length === 0) {
           this.dataTable.innerHTML = '';
           this.noResults.style.display = 'block';
           this.pagination.style.display = 'none';
           return;
         }
         
         this.noResults.style.display = 'none';
         this.pagination.style.display = 'flex';
         
         // è®¡ç®—åˆ†é¡µ
         this.totalPages = Math.ceil(this.filteredData.length / this.pageSize);
         const startIndex = (this.currentPage - 1) * this.pageSize;
         const endIndex = startIndex + this.pageSize;
         const currentPageData = this.filteredData.slice(startIndex, endIndex);
         
          this.dataTable.innerHTML = currentPageData.map(item => {
            const board = item.board || this.detectStockBoard(item.symbol);
            return `
           <tr class="table-row clickable" data-stockid="${item.stockid}" onclick="stockFilter.viewStockDetail(this)">
             <td>
               <div class="company-info">
                 <div class="company-name" title="${this.escapeHtml(item.company || 'N/A')}">${this.escapeHtml(this.truncateText(item.company || 'N/A', 20))}</div>
                 <div class="company-symbol">${this.escapeHtml(item.symbol || 'N/A')}</div>
               </div>
             </td>
             <td title="${this.escapeHtml(item.industry || 'N/A')}">${this.escapeHtml(this.truncateText(item.industry || 'N/A', 16))}</td>
             <td>
               <span class="board-tag ${this.getBoardClass(board)}">
                 ${board}
               </span>
             </td>
             <td class="price">${this.formatPrice(item.price)}</td>
             <td style="color: ${item.p_pct_change >= 0 ? '#ef4444' : '#10b981'}; font-weight: 600;">
               ${this.formatPercentage(item.p_pct_change)}
             </td>
             <td class="pe-ratio">${this.formatPE(item.pettm)}</td>
             <td class="dividend-yield">${this.formatDividendYield(item.yield)}</td>
             <td class="gf-value-cell">${this.formatGFValue(item.gf_value, item.price)}</td>
             <td>
               <span class="gf-score" style="font-weight: 600; color: ${this.getScoreColor(item.gf_score)};">
                 ${item.gf_score || 'N/A'}
               </span>
             </td>
             <td style="font-weight: 700; font-size: 13px; color: ${this.getValuationColor(item.gf_valuation)};">
               ${this.getValuationDescription(item.gf_valuation)}
             </td>
             <td>${this.formatMarketCap(item.mktcap_norm_currency)}</td>
           </tr>
         `;
          }).join('');
      }
      
      getValuationDescription(valuation) {
        const descriptions = {
          0: 'æ•°æ®ä¸è¶³',
          1: 'æ•°æ®é•¿ä¹…æœªæ›´æ–°ï¼Œè°¨æ…ä½¿ç”¨',
          2: 'ä»·å€¼é™·é˜±å«Œç–‘',
          3: 'ä¸¥é‡ä½ä¼°',
          4: 'ä½ä¼°',
          5: 'åˆç†èŒƒå›´',
          6: 'é«˜ä¼°',
          7: 'ä¸¥é‡é«˜ä¼°'
        };
        return descriptions[valuation] || 'æœªçŸ¥';
      }
      
      getValuationColor(valuation) {
        const colors = {
          0: '#6b7280',  // æ•°æ®ä¸è¶³ - ç°è‰²
          1: '#dc2626',  // æ•°æ®é•¿ä¹…æœªæ›´æ–°ï¼Œè°¨æ…ä½¿ç”¨ - çº¢è‰²
          2: '#dc2626',  // ä»·å€¼é™·é˜±å«Œç–‘ - çº¢è‰²
          3: '#059669',  // ä¸¥é‡ä½ä¼° - æ·±ç»¿è‰²
          4: '#10b981',  // ä½ä¼° - ç»¿è‰²
          5: '#3b82f6',  // åˆç†èŒƒå›´ - è“è‰²
          6: '#f59e0b',  // é«˜ä¼° - æ©™è‰²
          7: '#dc2626'   // ä¸¥é‡é«˜ä¼° - çº¢è‰²
        };
        return colors[valuation] || '#94a3b8';
      }
      
      updateDashboard() {
        if (this.allData.length === 0) {
          this.dashboard.style.display = 'none';
          return;
        }
        
        this.dashboard.style.display = 'block';
        this.updateValuationChart();
        this.updateChangeChart();
        // å»¶è¿Ÿæ‰§è¡Œç»Ÿè®¡æ›´æ–°ï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
        setTimeout(() => {
          // æ·»åŠ åŠ è½½å®Œæˆçš„åŠ¨ç”»æ•ˆæœ
          this.addDashboardLoadingAnimation();
          this.updateDividendStats();
          this.updateMarketOverview();
        }, 100);
      }
      
      updateValuationChart() {
        const valuationCounts = this.getValuationCounts();
        const chart = echarts.init(document.getElementById('valuationChart'));
        
         const option = {
           backgroundColor: 'transparent',
           tooltip: {
             trigger: 'item',
             formatter: '{a} <br/>{b}: {c} ({d}%)',
             backgroundColor: 'rgba(255,255,255,0.95)',
             borderColor: '#e2e8f0',
             textStyle: { color: '#334155' }
           },
           series: [{
             name: 'ä»·å€¼è¯„ä¼°åˆ†å¸ƒ',
            type: 'pie',
            roseType: 'radius',
            radius: ['45%', '75%'],
            center: ['50%', '50%'],
            avoidLabelOverlap: true,
            padAngle: 2,
            itemStyle: {
              borderRadius: 8,
              borderColor: 'rgba(255,255,255,0.8)',
              borderWidth: 2,
              shadowBlur: 5,
              shadowColor: 'rgba(0,0,0,0.08)',
              shadowOffsetY: 2
            },
            label: {
              show: true,
              position: 'outside',
              formatter: function(params) {
                return `{name|${params.name}}\n{value|${params.value}ä¸ª}`;
              },
              rich: {
                name: {
                  fontSize: 12,
                  fontWeight: '600',
                  color: '#334155',
                  lineHeight: 18
                },
                value: {
                  fontSize: 10,
                  fontWeight: '500',
                  color: '#64748b',
                  lineHeight: 14
                }
              },
              distanceToLabelLine: 5
            },
             emphasis: {
               label: {
                 fontSize: '13',
                 fontWeight: 'bold'
               },
               itemStyle: {
                 shadowBlur: 12,
                 shadowOffsetY: 3,
                 shadowColor: 'rgba(0, 0, 0, 0.15)',
                 borderWidth: 3,
                 borderColor: 'rgba(255,255,255,0.9)'
               },
               scale: true,
               scaleSize: 5
             },
            labelLine: {
              show: true,
              length: 12,
              length2: 8,
              smooth: true,
              lineStyle: {
                color: '#94a3b8',
                width: 2,
                type: 'solid',
                cap: 'round',
                opacity: 0.9
              }
            },
            data: valuationCounts.map(item => ({
              value: item.count,
              name: item.label,
              itemStyle: { color: item.color }
            }))
          }]
        };
        
         chart.setOption(option);
        
        // ä½¿ç”¨æ›´å®‰å…¨çš„resizeç›‘å¬æ–¹å¼
        let valuationResizeTimer;
        const handleValuationResize = () => {
          clearTimeout(valuationResizeTimer);
          valuationResizeTimer = setTimeout(() => {
            if (chart && !chart.isDisposed()) {
              chart.resize();
            }
          }, 100);
        };
        
        window.addEventListener('resize', handleValuationResize, { passive: true });
      }
      
      updateChangeChart() {
        const changeCounts = this.getChangeCounts();
        const chart = echarts.init(document.getElementById('changeChart'));
        
         const option = {
           backgroundColor: 'transparent',
           tooltip: {
             trigger: 'item',
             formatter: '{a} <br/>{b}: {c} ({d}%)',
             backgroundColor: 'rgba(255,255,255,0.95)',
             borderColor: '#e2e8f0',
             textStyle: { color: '#334155' }
           },
           series: [{
             name: 'æ¶¨è·Œå¹…åˆ†å¸ƒ',
            type: 'pie',
            roseType: 'radius',
            radius: ['45%', '75%'],
            center: ['50%', '50%'],
            avoidLabelOverlap: true,
            padAngle: 2,
            itemStyle: {
              borderRadius: 8,
              borderColor: 'rgba(255,255,255,0.8)',
              borderWidth: 2,
              shadowBlur: 5,
              shadowColor: 'rgba(0,0,0,0.08)',
              shadowOffsetY: 2
            },
            label: {
              show: true,
              position: 'outside',
              formatter: function(params) {
                return `{name|${params.name}}\n{value|${params.value}ä¸ª}`;
              },
              rich: {
                name: {
                  fontSize: 12,
                  fontWeight: '600',
                  color: '#334155',
                  lineHeight: 18
                },
                value: {
                  fontSize: 10,
                  fontWeight: '500',
                  color: '#64748b',
                  lineHeight: 14
                }
              },
              distanceToLabelLine: 5
            },
             emphasis: {
               label: {
                 fontSize: '13',
                 fontWeight: 'bold'
               },
               itemStyle: {
                 shadowBlur: 12,
                 shadowOffsetY: 3,
                 shadowColor: 'rgba(0, 0, 0, 0.15)',
                 borderWidth: 3,
                 borderColor: 'rgba(255,255,255,0.9)'
               },
               scale: true,
               scaleSize: 5
             },
            labelLine: {
              show: true,
              length: 12,
              length2: 8,
              smooth: true,
              lineStyle: {
                color: '#94a3b8',
                width: 2,
                type: 'solid',
                cap: 'round',
                opacity: 0.9
              }
            },
            data: changeCounts.map(item => ({
              value: item.count,
              name: item.label,
              itemStyle: { color: item.color }
            }))
          }]
        };
        
         chart.setOption(option);
        
        // ä½¿ç”¨æ›´å®‰å…¨çš„resizeç›‘å¬æ–¹å¼
        let changeResizeTimer;
        const handleChangeResize = () => {
          clearTimeout(changeResizeTimer);
          changeResizeTimer = setTimeout(() => {
            if (chart && !chart.isDisposed()) {
              chart.resize();
            }
          }, 100);
        };
        
        window.addEventListener('resize', handleChangeResize, { passive: true });
      }
      
      getValuationCounts() {
        const counts = {};
        const labels = {
          0: 'æ•°æ®ä¸è¶³',
          1: 'æ•°æ®é•¿ä¹…æœªæ›´æ–°ï¼Œè°¨æ…ä½¿ç”¨',
          2: 'ä»·å€¼é™·é˜±å«Œç–‘',
          3: 'ä¸¥é‡ä½ä¼°',
          4: 'ä½ä¼°',
          5: 'åˆç†èŒƒå›´',
          6: 'é«˜ä¼°',
          7: 'ä¸¥é‡é«˜ä¼°'
        };
        const colors = {
          0: '#94a3b8',   // æ•°æ®ä¸è¶³ - ä¸­æ€§ç°
          2: '#ef4444',   // ä»·å€¼é™·é˜± - è­¦å‘Šçº¢
          3: '#10b981',   // ä¸¥é‡ä½ä¼° - ç¿ ç»¿
          4: '#06d6a0',   // ä½ä¼° - æµ…ç»¿
          5: '#3b82f6',   // åˆç†èŒƒå›´ - è“è‰²
          6: '#f59e0b',   // é«˜ä¼° - æ©™è‰²
          7: '#dc2626'    // ä¸¥é‡é«˜ä¼° - æ·±çº¢
        };
        
        this.allData.forEach(item => {
          const val = item.gf_valuation;
          if (!counts[val]) {
            counts[val] = {
              count: 0,
              label: labels[val] || 'æœªçŸ¥',
              color: colors[val] || '#94a3b8'
            };
          }
          counts[val].count++;
        });
        
         // å›ºå®šé¡ºåºï¼šä¸¥é‡ä½ä¼° -> ä½ä¼° -> åˆç†èŒƒå›´ -> é«˜ä¼° -> ä¸¥é‡é«˜ä¼° -> ä»·å€¼é™·é˜±å«Œç–‘ -> æ•°æ®ä¸è¶³
         const orderedKeys = [3, 4, 5, 6, 7, 2, 0];
         return orderedKeys
           .filter(key => counts[key])
           .map(key => ({
             label: counts[key].label,
             count: counts[key].count,
             color: counts[key].color,
             percentage: ((counts[key].count / this.allData.length) * 100).toFixed(1)
           }));
      }
      
      getChangeCounts() {
        const ranges = [
          { key: 'up5+', label: 'ä¸Šæ¶¨5%ä»¥ä¸Š', min: 5, max: Infinity, color: '#e11d48' },
          { key: 'up2-5', label: 'ä¸Šæ¶¨2-5%', min: 2, max: 5, color: '#f43f5e' },
          { key: 'up0-2', label: 'ä¸Šæ¶¨0-2%', min: 0, max: 2, color: '#fb7185' },
          { key: 'flat', label: 'å¹³ç›˜', min: 0, max: 0, color: '#64748b' },
          { key: 'down0-2', label: 'ä¸‹è·Œ0-2%', min: -2, max: 0, color: '#4ade80' },
          { key: 'down2-5', label: 'ä¸‹è·Œ2-5%', min: -5, max: -2, color: '#22c55e' },
          { key: 'down5+', label: 'ä¸‹è·Œ5%ä»¥ä¸Š', min: -Infinity, max: -5, color: '#16a34a' }
        ];
        
        const counts = {};
        ranges.forEach(range => {
          counts[range.key] = { ...range, count: 0 };
        });
        
        this.allData.forEach(item => {
          const change = item.p_pct_change;
          if (change === undefined || change === null) return;
          
          for (const range of ranges) {
            if (change === 0 && range.key === 'flat') {
              counts[range.key].count++;
              break;
            } else if (change > range.min && change <= range.max) {
              counts[range.key].count++;
              break;
            }
          }
        });
        
         // å›ºå®šé¡ºåºï¼šä¸Šæ¶¨5%ä»¥ä¸Š -> ä¸Šæ¶¨2-5% -> ä¸Šæ¶¨0-2% -> å¹³ç›˜ -> ä¸‹è·Œ0-2% -> ä¸‹è·Œ2-5% -> ä¸‹è·Œ5%ä»¥ä¸Š
         const orderedKeys = ['up5+', 'up2-5', 'up0-2', 'flat', 'down0-2', 'down2-5', 'down5+'];
         return orderedKeys
           .filter(key => counts[key] && counts[key].count > 0)
           .map(key => ({
             label: counts[key].label,
             count: counts[key].count,
             color: counts[key].color,
             percentage: ((counts[key].count / this.allData.length) * 100).toFixed(1)
           }));
      }
      
      
      
      formatMarketCap(value) {
        if (!value) return 'N/A';
        
        if (value >= 1e12) {
          return (value / 1e12).toFixed(2) + 'ä¸‡äº¿';
        } else if (value >= 1e8) {
          return (value / 1e8).toFixed(2) + 'äº¿';
        } else if (value >= 1e4) {
          return (value / 1e4).toFixed(2) + 'ä¸‡';
        }
        return value.toFixed(2);
      }

      formatGFValue(gfValue, currentPrice) {
        // æ£€æŸ¥GFä»·å€¼æ˜¯å¦æœ‰æ•ˆ
        if (!gfValue || gfValue === 0 || isNaN(parseFloat(gfValue))) {
          return '<span class="gf-value no-data">æ— æ•°æ®</span>';
        }
        
        const gfVal = parseFloat(gfValue);
        const currPrice = parseFloat(currentPrice?.toString().replace('Â¥', '')) || 0;
        
        // æ ¹æ®GFä»·å€¼ä¸å½“å‰ä»·æ ¼çš„å…³ç³»ç¡®å®šæ ·å¼
        let className = 'no-data';
        let displayText = `Â¥${gfVal.toFixed(2)}`;
        
        if (currPrice > 0) {
          if (gfVal > currPrice) {
            // GFä»·å€¼é«˜äºå½“å‰ä»·æ ¼ï¼Œè‚¡ç¥¨è¢«ä½ä¼°
            className = 'undervalued';
            const upside = ((gfVal - currPrice) / currPrice * 100).toFixed(1);
            displayText = `Â¥${gfVal.toFixed(2)} (+${upside}%)`;
          } else if (gfVal < currPrice) {
            // GFä»·å€¼ä½äºå½“å‰ä»·æ ¼ï¼Œè‚¡ç¥¨è¢«é«˜ä¼°
            className = 'overvalued';
            const downside = ((currPrice - gfVal) / currPrice * 100).toFixed(1);
            displayText = `Â¥${gfVal.toFixed(2)} (-${downside}%)`;
          } else {
            // ä»·æ ¼ç›¸ç­‰ï¼Œåˆç†ä¼°å€¼
            className = 'undervalued'; // ä½¿ç”¨ç»¿è‰²è¡¨ç¤ºåˆç†
            displayText = `Â¥${gfVal.toFixed(2)} (åˆç†)`;
          }
        }
        
        return `<span class="gf-value ${className}">${displayText}</span>`;
      }

      formatPrice(price) {
        if (!price) return 'N/A';
        if (typeof price === 'string') {
          // å¦‚æœä»·æ ¼å·²ç»åŒ…å«è´§å¸ç¬¦å·ï¼Œç›´æ¥è¿”å›
          if (price.includes('Â¥') || price.includes('$')) {
            return price;
          }
          // å°è¯•è§£æä¸ºæ•°å­—
          const numPrice = parseFloat(price);
          if (isNaN(numPrice)) return price; // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›åŸå­—ç¬¦ä¸²
          return `Â¥${numPrice.toFixed(2)}`;
        }
        return `Â¥${price.toFixed(2)}`;
      }

      formatPE(pe) {
        if (!pe) return 'N/A';
        
        // è½¬æ¢ä¸ºæ•°å­—ç±»å‹
        const numPE = typeof pe === 'string' ? parseFloat(pe) : pe;
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
        if (!isNaN(numPE) && numPE > 1000) return '>1000';
        if(isNaN(numPE)) return pe;
        
        return numPE.toFixed(1);
      }

      formatDividendYield(yield_value) {
        if (!yield_value) return 'N/A';
        
        // è½¬æ¢ä¸ºæ•°å­—ç±»å‹
        const numYield = typeof yield_value === 'string' ? parseFloat(yield_value) : yield_value;
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
        if (isNaN(numYield) || numYield < 0) return 'N/A';
        
        // è‚¡æ¯ç‡é€šå¸¸ä»¥ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼Œä¿ç•™2ä½å°æ•°
        return `${numYield.toFixed(2)}%`;
      }

      formatPercentage(value) {
        if (value === undefined || value === null) return 'N/A';
        
        // è½¬æ¢ä¸ºæ•°å­—ç±»å‹
        const numValue = typeof value === 'string' ? parseFloat(value) : value;
        if (isNaN(numValue)) return 'N/A';
        
        return numValue.toFixed(2) + '%';
      }

      getScoreColor(score) {
        if (!score) return '#94a3b8';
        
        // è½¬æ¢ä¸ºæ•°å­—ç±»å‹
        const numScore = typeof score === 'string' ? parseFloat(score) : score;
        if (isNaN(numScore)) return '#94a3b8';
        
        if (numScore >= 80) return '#10b981'; // ç»¿è‰² - ä¼˜ç§€
        if (numScore >= 60) return '#f59e0b'; // æ©™è‰² - è‰¯å¥½
        if (numScore >= 40) return '#ef4444'; // çº¢è‰² - ä¸€èˆ¬
        return '#6b7280'; // ç°è‰² - è¾ƒå·®
      }

      truncateText(text, length) {
        if (!text) return 'N/A';
        if (text.length <= length) return text;
        return text.substring(0, length) + '...';
      }
      
      populateIndustryOptions() {
        // è·å–æ‰€æœ‰ä¸é‡å¤çš„è¡Œä¸š
        const industries = [...new Set(this.allData.map(item => item.industry).filter(industry => industry))].sort();
        
        // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆé™¤äº†é»˜è®¤çš„"æ‰€æœ‰è¡Œä¸š"ï¼‰
        this.industryFilter.innerHTML = '<option value="">æ‰€æœ‰è¡Œä¸š</option>';
        
        // æ·»åŠ è¡Œä¸šé€‰é¡¹
        industries.forEach(industry => {
          const option = document.createElement('option');
          option.value = industry;
          option.textContent = industry;
          this.industryFilter.appendChild(option);
        });
      }
      
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
       updateResultsCount() {
         const total = this.allData.length;
         const filtered = this.filteredData.length;
         const startIndex = (this.currentPage - 1) * this.pageSize + 1;
         const endIndex = Math.min(this.currentPage * this.pageSize, filtered);
         
         if (filtered === 0) {
           this.resultsCount.textContent = `æ˜¾ç¤º 0 / ${total} æ¡è®°å½•`;
         } else {
           this.resultsCount.textContent = `æ˜¾ç¤º ${startIndex}-${endIndex} / ${filtered} æ¡è®°å½• (æ€»è®¡ ${total} æ¡)`;
         }
       }
       
       renderPagination() {
         if (this.totalPages <= 1) {
           this.pagination.style.display = 'none';
           return;
         }
         
         this.pagination.style.display = 'flex';
         
         let paginationHTML = '';
         
         // ä¸Šä¸€é¡µæŒ‰é’®
         paginationHTML += `
           <button class="pagination-btn ${this.currentPage === 1 ? 'disabled' : ''}" 
                   onclick="stockFilter.goToPage(${this.currentPage - 1})" 
                   ${this.currentPage === 1 ? 'disabled' : ''}>
             ä¸Šä¸€é¡µ
           </button>
         `;
         
         // é¡µç æŒ‰é’®
         const maxVisiblePages = 7;
         let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
         let endPage = Math.min(this.totalPages, startPage + maxVisiblePages - 1);
         
         // è°ƒæ•´èµ·å§‹é¡µï¼Œç¡®ä¿æ˜¾ç¤ºè¶³å¤Ÿçš„é¡µç 
         if (endPage - startPage + 1 < maxVisiblePages) {
           startPage = Math.max(1, endPage - maxVisiblePages + 1);
         }
         
         // ç¬¬ä¸€é¡µ
         if (startPage > 1) {
           paginationHTML += `
             <button class="pagination-btn" onclick="stockFilter.goToPage(1)">1</button>
           `;
           if (startPage > 2) {
             paginationHTML += `<span class="pagination-info">...</span>`;
           }
         }
         
         // ä¸­é—´é¡µç 
         for (let page = startPage; page <= endPage; page++) {
           paginationHTML += `
             <button class="pagination-btn ${page === this.currentPage ? 'active' : ''}" 
                     onclick="stockFilter.goToPage(${page})">
               ${page}
             </button>
           `;
         }
         
         // æœ€åä¸€é¡µ
         if (endPage < this.totalPages) {
           if (endPage < this.totalPages - 1) {
             paginationHTML += `<span class="pagination-info">...</span>`;
           }
           paginationHTML += `
             <button class="pagination-btn" onclick="stockFilter.goToPage(${this.totalPages})">${this.totalPages}</button>
           `;
         }
         
         // ä¸‹ä¸€é¡µæŒ‰é’®
         paginationHTML += `
           <button class="pagination-btn ${this.currentPage === this.totalPages ? 'disabled' : ''}" 
                   onclick="stockFilter.goToPage(${this.currentPage + 1})" 
                   ${this.currentPage === this.totalPages ? 'disabled' : ''}>
             ä¸‹ä¸€é¡µ
           </button>
         `;
         
         // é¡µé¢ä¿¡æ¯
         paginationHTML += `
           <span class="pagination-info">ç¬¬ ${this.currentPage} / ${this.totalPages} é¡µ</span>
         `;
         
         this.pagination.innerHTML = paginationHTML;
       }
       
       goToPage(page) {
         if (page < 1 || page > this.totalPages || page === this.currentPage) {
           return;
         }
         
         this.currentPage = page;
         this.renderTable();
         this.updateResultsCount();
         this.renderPagination();
         
         // æ»šåŠ¨åˆ°è¡¨æ ¼é¡¶éƒ¨
         document.querySelector('.table-container').scrollIntoView({ 
           behavior: 'smooth', 
           block: 'start' 
         });
       }
       
       
       
       
        viewStockDetail(row) {
          try {
            // ä»data-stockidå±æ€§è·å–è‚¡ç¥¨ID
            const stockid = row.getAttribute('data-stockid');
            if (!stockid) {
              console.error('æœªæ‰¾åˆ°è‚¡ç¥¨ID');
              return;
            }
            
            // è·å–å½“å‰é€‰æ‹©çš„æ—¥æœŸ
            const currentDate = this.dateSelect.value;
            if (!currentDate) {
              console.error('æœªæ‰¾åˆ°å½“å‰æ—¥æœŸ');
              return;
            }
            
            // æ„å»ºè¯¦æƒ…é¡µé¢URLï¼Œä½¿ç”¨stockidå’Œdateå‚æ•°
            const detailUrl = `detail.html?stockid=${encodeURIComponent(stockid)}&date=${encodeURIComponent(currentDate)}`;
            
            // ä½¿ç”¨é“¾æ¥æ–¹å¼æ‰“å¼€è¯¦æƒ…é¡µé¢
            const link = document.createElement('a');
            link.href = detailUrl;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
          } catch (error) {
            console.error('æ‰“å¼€è‚¡ç¥¨è¯¦æƒ…é¡µé¢å¤±è´¥:', error);
            alert('æ— æ³•æ‰“å¼€è‚¡ç¥¨è¯¦æƒ…é¡µé¢');
          }
        }
      
      showLoading(show) {
        this.loadingIndicator.style.display = show ? 'block' : 'none';
      }
      
      showError(message) {
        this.errorMessage.textContent = message;
        this.errorMessage.style.display = 'block';
        
        // 5ç§’åè‡ªåŠ¨éšè—é”™è¯¯ä¿¡æ¯
        setTimeout(() => {
          this.errorMessage.style.display = 'none';
        }, 5000);
      }
    }
    
     // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
     let stockFilter;
     document.addEventListener('DOMContentLoaded', () => {
       stockFilter = new StockDataFilter();
     });
  </script>
</body>
</html>
