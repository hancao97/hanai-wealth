<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Permissions-Policy" content="unload=()">
  <title>HANAI · WEALTH - 智能投资决策平台</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    :root { 
      --bg: #f8fafc; 
      --card: #ffffff; 
      --text: #334155; 
      --accent: #3b82f6; 
      --border: rgba(0,0,0,0.1);
      --input-bg: rgba(255,255,255,0.8);
      --shadow: rgba(0,0,0,0.1);
      --primary: #1e40af;
      --secondary: #7c3aed;
      --gold: #f59e0b;
    }
    
    * { box-sizing: border-box; }
    
     html, body { 
       height: 100%; 
      margin: 0;
       font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
       background: linear-gradient(88deg, #dbeafe 0%, #e0e7ff 50%, var(--bg) 100%);
      color: var(--text);
     }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      margin-bottom: 30px;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .title-section {
      flex: 1;
    }
    
     .header h1 {
       margin: 0 0 10px;
       font-size: 42px;
       font-weight: 900;
       background: linear-gradient(135deg, #1e40af 0%, #3b82f6 30%, #7c3aed 60%, #f59e0b 100%);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       text-shadow: 0 4px 8px rgba(0,0,0,0.1);
       letter-spacing: 2px;
       text-transform: uppercase;
       position: relative;
       display: inline-block;
     }
     
     .header h1::before {
       content: '';
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       background: linear-gradient(135deg, #1e40af, #3b82f6, #7c3aed, #f59e0b);
       background-size: 300% 300%;
       animation: gradientShift 4s ease infinite;
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       z-index: -1;
     }
     
     @keyframes gradientShift {
       0% { background-position: 0% 50%; }
       50% { background-position: 100% 50%; }
       100% { background-position: 0% 50%; }
     }
     
     .header p {
      margin: 0;
       color: #64748b;
       font-size: 16px;
       font-weight: 500;
       letter-spacing: 1px;
     }
    
    .date-selector {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 200px;
    }
    
     .date-selector label {
       font-weight: 600;
       color: #1e40af;
       font-size: 14px;
       text-transform: uppercase;
       letter-spacing: 0.5px;
     }
    
     .date-select-input {
       padding: 12px 40px 12px 16px;
       background: white;
       border: 2px solid #d1d5db;
       border-radius: 12px;
       color: var(--text);
       font-size: 16px;
       font-weight: 600;
       transition: all 0.3s ease;
       box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     }
     
     .date-select-input:focus {
       outline: none;
       border-color: #3b82f6;
       box-shadow: 0 0 0 3px rgba(59,130,246,0.2), 0 4px 12px rgba(0,0,0,0.15);
       transform: translateY(-1px);
     }
     
     .date-select-input:hover {
       border-color: #3b82f6;
       transform: translateY(-1px);
     }
    
     .date-status {
       font-size: 12px;
       color: #64748b;
       font-weight: 500;
       padding: 4px 8px;
       background: #f1f5f9;
       border-radius: 6px;
       text-align: center;
       transition: all 0.2s ease;
     }
     
     .date-status.loading {
       color: #d97706;
       background: #fef3c7;
     }
     
     .date-status.success {
       color: #1e40af;
       background: #dbeafe;
     }
     
     .date-status.error {
       color: #dc2626;
       background: #fee2e2;
     }
    
     .filters {
       background: white;
       border: 1px solid var(--border);
      border-radius: 16px;
       padding: 24px;
       margin-bottom: 24px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.05);
     }
    
    .filter-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
     .filter-group label {
       font-weight: 500;
       color: #64748b;
       font-size: 13px;
     }
    
     .filter-input {
       padding: 8px 24px 8px 10px;
       background: white;
       border: 1px solid #d1d5db;
       border-radius: 8px;
      color: var(--text);
       font-size: 13px;
       transition: border-color 0.2s ease;
     }
     
     .filter-input:focus {
       outline: none;
       border-color: var(--accent);
       box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
     }
     
     .filter-input::placeholder {
       color: #9ca3af;
     }
    
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    
     .results-count {
       color: #64748b;
       font-size: 14px;
     }
     
     .loading {
       color: #d97706;
     }
    
     .table-container {
       background: white;
       border: 1px solid var(--border);
       border-radius: 16px;
       overflow: hidden;
       box-shadow: 0 4px 12px rgba(0,0,0,0.05);
     }
    
    .table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    
    .table th,
    .table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
      .table th:nth-child(1), .table td:nth-child(1) { width: 100px; } /* 公司信息 */
      .table th:nth-child(2), .table td:nth-child(2) { width: 150px; } /* 行业 */
      .table th:nth-child(3), .table td:nth-child(3) { width: 70px; }  /* 板块 */
      .table th:nth-child(4), .table td:nth-child(4) { width: 80px; }  /* 价格 */
      .table th:nth-child(5), .table td:nth-child(5) { width: 80px; }  /* 涨跌幅 */
      .table th:nth-child(6), .table td:nth-child(6) { width: 70px; }  /* 市盈率 */
      .table th:nth-child(7), .table td:nth-child(7) { width: 70px; }  /* 股息率 */
      .table th:nth-child(8), .table td:nth-child(8) { width: 80px; }  /* 价值评分 */
      .table th:nth-child(9), .table td:nth-child(9) { width: 100px; } /* 价值评估 */
      .table th:nth-child(10), .table td:nth-child(10) { width: 100px; } /* 市值 */
    
     .table th {
       background: #f8fafc;
       font-weight: 600;
       color: #475569;
       font-size: 13px;
       text-transform: uppercase;
       letter-spacing: 0.5px;
     }
    
    .table td {
      font-size: 14px;
    }
    
     .table tbody tr:hover {
       background: #f8fafc;
     }
     
     .table tbody tr.clickable {
      cursor: pointer;
       transition: all 0.2s ease;
     }
     
     .table tbody tr.clickable:hover {
       background: #e2e8f0;
       transform: translateY(-1px);
       box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     }
    
    .gf-valuation {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
      font-size: 12px;
    }
    
    .gf-0 { background: #6b7280; color: white; } /* 数据不足 - 灰色 */
    .gf-1 { background: #dc2626; color: white; } /* 数据长久未更新，谨慎使用 - 红色 */
    .gf-2 { background: #dc2626; color: white; } /* 价值陷阱嫌疑 - 红色 */
    .gf-3 { background: #059669; color: white; } /* 严重低估 - 深绿色 */
    .gf-4 { background: #10b981; color: white; } /* 低估 - 绿色 */
    .gf-5 { background: #3b82f6; color: white; } /* 合理范围 - 蓝色 */
    .gf-6 { background: #f59e0b; color: white; } /* 高估 - 橙色 */
    .gf-7 { background: #dc2626; color: white; } /* 严重高估 - 红色 */
    
    .price {
      font-weight: 600;
      color: var(--accent);
    }
    
    .symbol {
      font-family: 'Courier New', monospace;
      color: #94a3b8;
      font-size: 12px;
    }
    
    .board-tag {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
      font-size: 12px;
    }
    
    .board-main { background: #3b82f6; color: white; } /* 主板 - 蓝色 */
    .board-growth { background: #10b981; color: white; } /* 创业板 - 绿色 */
    .board-star { background: #f59e0b; color: white; } /* 科创板 - 橙色 */
     .board-north { background: #8b5cf6; color: white; } /* 北证 - 紫色 */
     
     .company-info {
       display: flex;
       flex-direction: column;
       gap: 2px;
     }
     
     .company-name {
       font-weight: 600;
       font-size: 13px;
       color: #1e40af;
       line-height: 1.2;
     }
     
     .company-symbol {
       font-size: 11px;
       color: #64748b;
       font-weight: 500;
     }
     
     /* 股息率统计样式 */
     .dividend-stats-container {
       background: white;
       border: 1px solid #e2e8f0;
       border-radius: 16px;
       padding: 24px;
       margin: 24px 0;
       box-shadow: 0 4px 12px rgba(0,0,0,0.05);
     }
     
     .dividend-stats-title {
       margin: 0 0 20px 0;
       font-size: 18px;
       font-weight: 700;
       color: #1e293b;
       text-align: center;
       padding-bottom: 8px;
       border-bottom: 2px solid #e2e8f0;
     }
     
     .dividend-stats-grid {
       display: grid;
       grid-template-columns: repeat(6, 1fr);
       gap: 12px;
     }
     
     .dividend-stat-item {
       background: white;
       border: 2px solid #e2e8f0;
       border-radius: 12px;
       padding: 12px 8px;
       text-align: center;
       transition: transform 0.2s ease, box-shadow 0.2s ease;
     }
     
     .dividend-stat-item:hover {
       transform: translateY(-2px);
       box-shadow: 0 8px 24px rgba(0,0,0,0.1);
     }
     
     .dividend-stat-item.clickable {
       cursor: pointer;
     }
     
     .dividend-stat-item.clickable:hover {
       transform: translateY(-3px);
       box-shadow: 0 12px 32px rgba(0,0,0,0.15);
     }
     
     .dividend-stat-item.active {
       background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
       border-color: #1d4ed8;
       transform: translateY(-2px);
       box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
     }
     
     .dividend-stat-item.active .dividend-stat-value {
       color: white !important;
     }
     
     .dividend-stat-item.active .dividend-stat-label {
       color: rgba(255, 255, 255, 0.95) !important;
     }
     
     .dividend-stat-item.active .dividend-stat-desc {
       color: rgba(255, 255, 255, 0.8) !important;
     }
     
     .dividend-stat-item.active:hover {
       background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
       transform: translateY(-3px);
       box-shadow: 0 12px 32px rgba(59, 130, 246, 0.4);
     }
     
     .dividend-stat-value {
       font-size: 20px;
       font-weight: 700;
       margin-bottom: 6px;
       line-height: 1.1;
     }
     
     .dividend-stat-label {
       font-size: 11px;
       font-weight: 600;
       margin-bottom: 3px;
       color: #334155;
       line-height: 1.2;
     }
     
     .dividend-stat-desc {
       font-size: 9px;
       color: #64748b;
       line-height: 1.2;
     }
     
     /* 不同股息率水平的颜色 */
     .dividend-low { border-color: #94a3b8; background: #f8fafc; }
     .dividend-low .dividend-stat-value { color: #94a3b8; }
     
     .dividend-medium { border-color: #3b82f6; background: #dbeafe; }
     .dividend-medium .dividend-stat-value { color: #3b82f6; }
     
     .dividend-high { border-color: #10b981; background: #d1fae5; }
     .dividend-high .dividend-stat-value { color: #10b981; }
     
     .dividend-super-high { border-color: #f59e0b; background: #fef3c7; }
     .dividend-super-high .dividend-stat-value { color: #f59e0b; }
     
     .dividend-abnormal { border-color: #ef4444; background: #fee2e2; }
     .dividend-abnormal .dividend-stat-value { color: #ef4444; }
     
     .dividend-no-data { border-color: #6b7280; background: #f9fafb; }
     .dividend-no-data .dividend-stat-value { color: #6b7280; }
      
       .no-results {
       text-align: center;
       padding: 40px;
       color: #64748b;
     }
    
     .error {
       background: #fee2e2;
       border: 1px solid #fca5a5;
       color: #dc2626;
       padding: 12px 16px;
       border-radius: 8px;
       margin-bottom: 20px;
     }
    
    /* 仪表板样式 */
    .dashboard {
      margin-bottom: 24px;
    }
    
    .dashboard-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
     .dashboard-card {
       background: white;
       border: 1px solid #e2e8f0;
      border-radius: 16px;
       padding: 24px;
       box-shadow: 0 8px 32px rgba(0,0,0,0.1);
       position: relative;
       overflow: hidden;
     }
     
     .dashboard-card::before {
       content: '';
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       height: 3px;
       background: linear-gradient(90deg, #1e40af, #3b82f6, #7c3aed);
     }
     
     .dashboard-card h3 {
       margin: 0 0 16px;
       color: #1e40af;
       font-size: 18px;
       font-weight: 600;
       text-align: center;
     }
    
    .chart-container {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }
    
    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      font-size: 12px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }
    
     
     /* 分页样式 */
     .pagination {
       display: flex;
       justify-content: center;
       align-items: center;
       gap: 8px;
       margin: 20px 0;
       flex-wrap: wrap;
     }
     
     .pagination-btn {
       padding: 8px 12px;
       background: white;
       border: 1px solid #d1d5db;
       border-radius: 6px;
       color: #374151;
       font-size: 14px;
      cursor: pointer;
       transition: all 0.2s ease;
       min-width: 40px;
       text-align: center;
     }
     
     .pagination-btn:hover {
       background: #f3f4f6;
       border-color: #9ca3af;
     }
     
     .pagination-btn.active {
       background: #3b82f6;
       border-color: #3b82f6;
       color: white;
     }
     
     .pagination-btn:disabled {
       background: #f9fafb;
       border-color: #e5e7eb;
       color: #9ca3af;
       cursor: not-allowed;
     }
     
     .pagination-info {
       color: #64748b;
       font-size: 14px;
       margin: 0 16px;
     }
    
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      
      .title-section {
        order: 1;
      }
      
      .header h1 {
        font-size: 28px;
        letter-spacing: 1px;
      }
      
      .header p {
        font-size: 14px;
      }
      
      .date-selector {
        order: 2;
        min-width: auto;
      }
      
      .dashboard-row {
        grid-template-columns: 1fr;
      }
      
      .filter-row {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      
      .filter-input {
        padding: 6px 16px 6px 8px;
        font-size: 12px;
      }
      
      .filter-group label {
        font-size: 12px;
      }
      
      .pagination {
        gap: 4px;
        margin: 16px 0;
      }
      
      .pagination-btn {
        padding: 6px 8px;
        font-size: 12px;
        min-width: 32px;
      }
      
      .pagination-info {
        font-size: 12px;
        margin: 0 8px;
      }
      
      .dividend-stats-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      
      .dividend-stat-item {
        padding: 10px 6px;
      }
      
      .dividend-stat-value {
        font-size: 18px;
      }
      
      .dividend-stat-label {
        font-size: 10px;
      }
      
      .dividend-stat-desc {
        font-size: 8px;
      }
      
      .dividend-stats-title {
        font-size: 16px;
      }
      
      .dividend-stats-container {
        padding: 16px;
        margin: 16px 0;
      }
    }
    
    @media (max-width: 480px) {
      .filter-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .filter-input {
        padding: 5px 12px 5px 6px;
        font-size: 11px;
      }
      
      .filter-group label {
        font-size: 11px;
      }
      
      .dividend-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .dividend-stat-item {
        padding: 8px 4px;
      }
      
      .dividend-stat-value {
        font-size: 16px;
      }
      
      .dividend-stat-label {
        font-size: 9px;
      }
      
      .dividend-stat-desc {
        font-size: 7px;
      }
      
      .dividend-stats-container {
        padding: 12px;
        margin: 12px 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="title-section">
           <h1>HANAI · WEALTH</h1>
           <p>智能股票价值分析 · 专业投资决策支持</p>
        </div>
        <div class="date-selector">
          <label for="dateSelectTop">数据日期</label>
          <select id="dateSelectTop" class="date-select-input">
            <!-- 日期选项将通过JavaScript动态加载 -->
          </select>
          <div class="date-status" id="dateStatus">选择日期以查看数据</div>
        </div>
      </div>
    </div>
    
    <!-- 仪表板 -->
    <div class="dashboard" id="dashboard" style="display: none;">
      <div class="dashboard-row">
        <!-- 价值评估分布 -->
        <div class="dashboard-card">
          <h3>价值评估分布</h3>
          <div class="chart-container">
            <div id="valuationChart" style="width: 100%; height: 300px;"></div>
          </div>
    </div>

        <!-- 涨跌幅分布 -->
        <div class="dashboard-card">
          <h3>涨跌幅分布</h3>
          <div class="chart-container">
            <div id="changeChart" style="width: 100%; height: 300px;"></div>
    </div>
        </div>
      </div>
      
      <!-- 股息率统计 -->
      <div class="dividend-stats-container">
        <h3 class="dividend-stats-title">股息率分布统计</h3>
        <div class="dividend-stats-grid" id="dividendStatsGrid">
          <div class="dividend-stat-item dividend-low clickable" data-dividend="low" onclick="stockFilter.filterByDividend('low')">
            <div class="dividend-stat-value" id="lowDividendCount">0</div>
            <div class="dividend-stat-label">低股息 (< 1%)</div>
            <div class="dividend-stat-desc">分红微弱，典型成长股</div>
          </div>
          <div class="dividend-stat-item dividend-medium clickable" data-dividend="medium" onclick="stockFilter.filterByDividend('medium')">
            <div class="dividend-stat-value" id="mediumDividendCount">0</div>
            <div class="dividend-stat-label">中等股息 (1-3%)</div>
            <div class="dividend-stat-desc">接近市场平均水平</div>
          </div>
          <div class="dividend-stat-item dividend-high clickable" data-dividend="high" onclick="stockFilter.filterByDividend('high')">
            <div class="dividend-stat-value" id="highDividendCount">0</div>
            <div class="dividend-stat-label">高股息 (3-5%)</div>
            <div class="dividend-stat-desc">高于大盘，稳定现金流</div>
          </div>
          <div class="dividend-stat-item dividend-super-high clickable" data-dividend="super-high" onclick="stockFilter.filterByDividend('super-high')">
            <div class="dividend-stat-value" id="superHighDividendCount">0</div>
            <div class="dividend-stat-label">超高股息 (5-8%)</div>
            <div class="dividend-stat-desc">银行煤炭等传统行业</div>
          </div>
          <div class="dividend-stat-item dividend-abnormal clickable" data-dividend="abnormal" onclick="stockFilter.filterByDividend('abnormal')">
            <div class="dividend-stat-value" id="abnormalDividendCount">0</div>
            <div class="dividend-stat-label">异常高股息 (> 8%)</div>
            <div class="dividend-stat-desc">需谨慎，可能不可持续</div>
          </div>
          <div class="dividend-stat-item dividend-no-data clickable" data-dividend="no-data" onclick="stockFilter.filterByDividend('no-data')">
            <div class="dividend-stat-value" id="noDividendDataCount">0</div>
            <div class="dividend-stat-label">无股息数据</div>
            <div class="dividend-stat-desc">缺少分红信息</div>
          </div>
        </div>
      </div>
      
    </div>
    
    <div class="filters">
      <div class="filter-row">
        
        <div class="filter-group">
          <label for="companyFilter">公司名称</label>
          <input 
            type="text" 
            id="companyFilter" 
            class="filter-input" 
            placeholder="输入公司名称进行筛选..."
          >
        </div>
        
        <div class="filter-group">
          <label for="valuationFilter">GF估值</label>
          <select id="valuationFilter" class="filter-input">
            <option value="">所有估值</option>
            <option value="0">数据不足</option>
            <option value="1">数据长久未更新，谨慎使用</option>
            <option value="2">价值陷阱嫌疑</option>
            <option value="3">严重低估</option>
            <option value="4">低估</option>
            <option value="5">合理范围</option>
            <option value="6">高估</option>
            <option value="7">严重高估</option>
          </select>
        </div>
        
         <div class="filter-group">
           <label for="industryFilter">行业</label>
           <select id="industryFilter" class="filter-input">
             <option value="">所有行业</option>
           </select>
         </div>
         
         <div class="filter-group">
           <label for="boardFilter">板块</label>
           <select id="boardFilter" class="filter-input">
             <option value="">所有板块</option>
             <option value="主板">主板</option>
             <option value="创业板">创业板</option>
             <option value="科创板">科创板</option>
             <option value="北证">北证</option>
           </select>
         </div>
         
         <div class="filter-group">
           <label for="dividendFilter">股息率</label>
           <select id="dividendFilter" class="filter-input">
             <option value="">所有股息率</option>
             <option value="low">低股息 (< 1%)</option>
             <option value="medium">中等股息 (1-3%)</option>
             <option value="high">高股息 (3-5%)</option>
             <option value="super-high">超高股息 (5-8%)</option>
             <option value="abnormal">异常高股息 (> 8%)</option>
             <option value="no-data">无股息数据</option>
           </select>
         </div>
      </div>
    </div>
    

    <div class="status-bar">
      <div class="results-count" id="resultsCount">加载中...</div>
      <div id="loadingIndicator" class="loading" style="display: none;">正在加载数据...</div>
    </div>
    
    <div id="errorMessage" class="error" style="display: none;"></div>
    
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
             <th>公司信息</th>
             <th>行业</th>
             <th>板块</th>
             <th>价格</th>
             <th>涨跌幅</th>
             <th>市盈率</th>
             <th>股息率</th>
             <th>价值评分</th>
             <th>价值评估</th>
             <th>市值</th>
          </tr>
        </thead>
        <tbody id="dataTable">
          <!-- 数据将通过JavaScript动态加载 -->
        </tbody>
      </table>
    </div>

     <!-- 分页控件 -->
     <div class="pagination" id="pagination" style="display: none;"></div>
 
     <div id="noResults" class="no-results" style="display: none;">
       <p>没有找到符合条件的数据</p>
     </div>
    </div>

  <script>
     class StockDataFilter {
       constructor() {
         this.allData = [];
         this.filteredData = [];
         this.availableDates = [];
         this.currentDate = null;
         this.currentPage = 1;
         this.pageSize = 100;
         this.totalPages = 0;
         
         this.initializeElements();
         this.loadDatesConfig();
       }
      
      initializeElements() {
        this.dateSelect = document.getElementById('dateSelectTop');
         this.companyFilter = document.getElementById('companyFilter');
         this.valuationFilter = document.getElementById('valuationFilter');
         this.industryFilter = document.getElementById('industryFilter');
         this.boardFilter = document.getElementById('boardFilter');
         this.dividendFilter = document.getElementById('dividendFilter');
        this.dataTable = document.getElementById('dataTable');
        this.resultsCount = document.getElementById('resultsCount');
        this.loadingIndicator = document.getElementById('loadingIndicator');
        this.errorMessage = document.getElementById('errorMessage');
         this.noResults = document.getElementById('noResults');
         this.dashboard = document.getElementById('dashboard');
         this.dateStatus = document.getElementById('dateStatus');
         this.pagination = document.getElementById('pagination');
        
        this.setupEventListeners();
      }
      
      setupEventListeners() {
        this.dateSelect.addEventListener('change', () => this.loadDataForDate());
         this.companyFilter.addEventListener('input', () => this.applyFilters());
         this.valuationFilter.addEventListener('change', () => this.applyFilters());
         this.industryFilter.addEventListener('change', () => this.applyFilters());
         this.boardFilter.addEventListener('change', () => this.applyFilters());
         this.dividendFilter.addEventListener('change', () => this.applyFilters());
      }
      
      async loadDatesConfig() {
        try {
          this.showLoading(true);
          console.log('正在加载日期配置...');
          const response = await fetch('./dates.json');
          console.log('日期配置响应状态:', response.status);
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const dates = await response.json();
          console.log('加载到的日期:', dates);
          
          this.availableDates = dates.sort().reverse(); // 最新日期在前
          this.populateDateSelect();
          
          if (this.availableDates.length > 0) {
            // 检查URL参数中是否有指定日期
            const urlParams = new URLSearchParams(window.location.search);
            const urlDate = urlParams.get('date');
            
            let selectedDate;
            if (urlDate && this.availableDates.includes(urlDate)) {
              // 使用URL参数中的日期
              selectedDate = urlDate;
            } else {
              // 默认选择最新日期
              selectedDate = this.availableDates[0];
            }
            
            this.currentDate = selectedDate;
            this.dateSelect.value = selectedDate;
            await this.loadDataForDate();
          }
        } catch (error) {
          console.error('加载日期配置失败:', error);
          this.showError('无法加载日期配置: ' + error.message);
        } finally {
          this.showLoading(false);
        }
      }
      
      populateDateSelect() {
        this.dateSelect.innerHTML = '';
        this.availableDates.forEach(date => {
          const option = document.createElement('option');
          option.value = date;
          option.textContent = date;
          this.dateSelect.appendChild(option);
        });
        
        // 确保日期选择器不能为空
        this.dateSelect.required = true;
      }
      
      async loadDataForDate() {
        const selectedDate = this.dateSelect.value;
        if (!selectedDate) return;
        
        try {
          this.showLoading(true);
          this.updateDateStatus('加载中...', 'loading');
          this.currentDate = selectedDate;
          
          const response = await fetch(`./assets/${selectedDate}.json`);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
            this.allData = await response.json();
            this.updateDateStatus(`${selectedDate} 数据已加载 (${this.allData.length.toLocaleString()}条)`, 'success');
            this.populateIndustryOptions();
            this.updateDashboard();
            this.applyFilters();
        } catch (error) {
          this.showError(`无法加载 ${selectedDate} 的数据: ${error.message}`);
          this.updateDateStatus(`加载失败`, 'error');
          this.allData = [];
          this.applyFilters();
        } finally {
          this.showLoading(false);
        }
      }
      
      updateDateStatus(message, type = '') {
        this.dateStatus.textContent = message;
        this.dateStatus.className = `date-status ${type}`;
      }
      
      
      updateDividendStats() {
        if (!this.allData || this.allData.length === 0) {
          return;
        }
        
        // 统计各个股息率水平的数量
        let lowDividend = 0;         // < 1%
        let mediumDividend = 0;      // 1% - 3%
        let highDividend = 0;        // 3% - 5%
        let superHighDividend = 0;   // 5% - 8%
        let abnormalDividend = 0;    // > 8%
        let noDividendData = 0;      // 无数据
        
        this.allData.forEach(item => {
          const yield_value = item.yield;
          
          // 检查是否有yield值
          if (yield_value === null || yield_value === undefined || yield_value === '' || yield_value === 0) {
            noDividendData++;
            return;
          }
          
            // 转换为数字
            const numYield = parseFloat(yield_value);
          
          // 检查是否为有效数字
          if (isNaN(numYield) || numYield < 0) {
            noDividendData++;
          } else if (numYield < 1) {
            lowDividend++;
          } else if (numYield < 3) {
            mediumDividend++;
          } else if (numYield < 5) {
            highDividend++;
          } else if (numYield <= 8) {
            superHighDividend++;
          } else {
            abnormalDividend++;
          }
        });
        
        // 更新DOM - 添加安全检查
        const updateElement = (id, value) => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value.toLocaleString();
          }
        };
        
        updateElement('lowDividendCount', lowDividend);
        updateElement('mediumDividendCount', mediumDividend);
        updateElement('highDividendCount', highDividend);
        updateElement('superHighDividendCount', superHighDividend);
        updateElement('abnormalDividendCount', abnormalDividend);
        updateElement('noDividendDataCount', noDividendData);
      }
      
      // 获取股息率分类
      getDividendCategory(yield_value) {
        // 检查是否有yield值
        if (yield_value === null || yield_value === undefined || yield_value === '' || yield_value === 0) {
          return 'no-data';
        }
        
        // 转换为数字
        const numYield = parseFloat(yield_value);
        
        // 检查是否为有效数字
        if (isNaN(numYield) || numYield < 0) {
          return 'no-data';
        } else if (numYield < 1) {
          return 'low';
        } else if (numYield < 3) {
          return 'medium';
        } else if (numYield < 5) {
          return 'high';
        } else if (numYield <= 8) {
          return 'super-high';
        } else {
          return 'abnormal';
        }
      }
      
      // 股息率筛选功能
      filterByDividend(dividend) {
        if (this.dividendFilter.value === dividend) {
          // 如果已经选择了该股息率，则清除筛选
          this.dividendFilter.value = '';
        } else {
          // 设置股息率筛选
          this.dividendFilter.value = dividend;
        }
        this.applyFilters();
        this.updateDividendStatActiveState();
      }
      
      // 更新股息率统计卡片的激活状态
      updateDividendStatActiveState() {
        const dividendItems = document.querySelectorAll('.dividend-stat-item[data-dividend]');
        const selectedDividend = this.dividendFilter ? this.dividendFilter.value : '';
        
        dividendItems.forEach(item => {
          const dividend = item.getAttribute('data-dividend');
          if (dividend === selectedDividend) {
            item.classList.add('active');
          } else {
            item.classList.remove('active');
          }
        });
      }
      
      // 根据股票代码检测板块类型
      detectStockBoard(symbol) {
        if (!symbol || typeof symbol !== 'string') {
          return '主板';
        }
        
        const code = symbol.trim();
        
        // 主板：000/001/002/003/600/601/603/605 开头
        if (/^(000|001|002|003|600|601|603|605)/.test(code)) {
          return '主板';
        }
        
        // 创业板：300/301 开头  
        if (/^(300|301)/.test(code)) {
          return '创业板';
        }
        
        // 科创板：688 开头
        if (/^688/.test(code)) {
          return '科创板';
        }
        
        // 北证：43/83/87/92 开头
        if (/^(43|83|87|92)/.test(code)) {
          return '北证';
        }
        
        // 未知情况，计入主板
        return '主板';
      }
      
      // 获取板块对应的CSS类
      getBoardClass(board) {
        const classMap = {
          '主板': 'board-main',
          '创业板': 'board-growth',
          '科创板': 'board-star',
          '北证': 'board-north'
        };
        return classMap[board] || 'board-main';
      }
      
      applyFilters() {
        // 如果关键筛选器元素还没有初始化，跳过筛选
        if (!this.companyFilter || !this.valuationFilter || !this.dividendFilter) {
          return;
        }
        
        let filtered = [...this.allData];
        
        // 公司名称筛选
        const companyQuery = this.companyFilter.value.trim().toLowerCase();
        if (companyQuery) {
          filtered = filtered.filter(item => 
            item.company && item.company.toLowerCase().includes(companyQuery)
          );
        }
        
        // GF估值筛选
        const valuationValue = this.valuationFilter.value;
        if (valuationValue) {
          const targetValuation = Number(valuationValue);
          filtered = filtered.filter(item => {
            const valuation = item.gf_valuation;
            return valuation === targetValuation;
          });
        }
        
         // 行业筛选
         if (this.industryFilter) {
           const industryValue = this.industryFilter.value;
           if (industryValue) {
             filtered = filtered.filter(item => {
               return item.industry === industryValue;
             });
           }
         }
         
         // 板块筛选
         if (this.boardFilter) {
           const boardValue = this.boardFilter.value;
           if (boardValue) {
             filtered = filtered.filter(item => {
               const board = item.board || this.detectStockBoard(item.symbol);
               return board === boardValue;
             });
           }
         }
         
         // 股息率筛选
         if (this.dividendFilter) {
           const dividendValue = this.dividendFilter.value;
           if (dividendValue) {
             filtered = filtered.filter(item => {
               const yield_value = item.yield;
               const category = this.getDividendCategory(yield_value);
               return category === dividendValue;
             });
           }
         }
        
         this.filteredData = filtered;
         this.currentPage = 1; // 重置到第一页
         this.renderTable();
         this.updateResultsCount();
         this.renderPagination();
         this.updateDividendStatActiveState();
      }
      
       renderTable() {
         if (this.filteredData.length === 0) {
           this.dataTable.innerHTML = '';
           this.noResults.style.display = 'block';
           this.pagination.style.display = 'none';
           return;
         }
         
         this.noResults.style.display = 'none';
         this.pagination.style.display = 'flex';
         
         // 计算分页
         this.totalPages = Math.ceil(this.filteredData.length / this.pageSize);
         const startIndex = (this.currentPage - 1) * this.pageSize;
         const endIndex = startIndex + this.pageSize;
         const currentPageData = this.filteredData.slice(startIndex, endIndex);
         
          this.dataTable.innerHTML = currentPageData.map(item => {
            const board = item.board || this.detectStockBoard(item.symbol);
            return `
           <tr class="table-row clickable" data-stockid="${item.stockid}" onclick="stockFilter.viewStockDetail(this)">
             <td>
               <div class="company-info">
                 <div class="company-name" title="${this.escapeHtml(item.company || 'N/A')}">${this.escapeHtml(this.truncateText(item.company || 'N/A', 15))}</div>
                 <div class="company-symbol">${this.escapeHtml(item.symbol || 'N/A')}</div>
               </div>
             </td>
             <td title="${this.escapeHtml(item.industry || 'N/A')}">${this.escapeHtml(this.truncateText(item.industry || 'N/A', 12))}</td>
             <td>
               <span class="board-tag ${this.getBoardClass(board)}">
                 ${board}
               </span>
             </td>
             <td class="price">${this.formatPrice(item.price)}</td>
             <td style="color: ${item.p_pct_change >= 0 ? '#ef4444' : '#10b981'}; font-weight: 600;">
               ${this.formatPercentage(item.p_pct_change)}
             </td>
             <td class="pe-ratio">${this.formatPE(item.pettm)}</td>
             <td class="dividend-yield">${this.formatDividendYield(item.yield)}</td>
             <td>
               <span class="gf-score" style="font-weight: 600; color: ${this.getScoreColor(item.gf_score)};">
                 ${item.gf_score || 'N/A'}
               </span>
             </td>
             <td style="font-weight: 700; font-size: 13px; color: ${this.getValuationColor(item.gf_valuation)};">
               ${this.getValuationDescription(item.gf_valuation)}
             </td>
             <td>${this.formatMarketCap(item.mktcap_norm_currency)}</td>
           </tr>
         `;
          }).join('');
      }
      
      getValuationDescription(valuation) {
        const descriptions = {
          0: '数据不足',
          1: '数据长久未更新，谨慎使用',
          2: '价值陷阱嫌疑',
          3: '严重低估',
          4: '低估',
          5: '合理范围',
          6: '高估',
          7: '严重高估'
        };
        return descriptions[valuation] || '未知';
      }
      
      getValuationColor(valuation) {
        const colors = {
          0: '#6b7280',  // 数据不足 - 灰色
          1: '#dc2626',  // 数据长久未更新，谨慎使用 - 红色
          2: '#dc2626',  // 价值陷阱嫌疑 - 红色
          3: '#059669',  // 严重低估 - 深绿色
          4: '#10b981',  // 低估 - 绿色
          5: '#3b82f6',  // 合理范围 - 蓝色
          6: '#f59e0b',  // 高估 - 橙色
          7: '#dc2626'   // 严重高估 - 红色
        };
        return colors[valuation] || '#94a3b8';
      }
      
      updateDashboard() {
        if (this.allData.length === 0) {
          this.dashboard.style.display = 'none';
          return;
        }
        
        this.dashboard.style.display = 'block';
        this.updateValuationChart();
        this.updateChangeChart();
        // 延迟执行股息率统计更新，确保DOM已渲染
        setTimeout(() => {
          this.updateDividendStats();
        }, 100);
      }
      
      updateValuationChart() {
        const valuationCounts = this.getValuationCounts();
        const chart = echarts.init(document.getElementById('valuationChart'));
        
         const option = {
           backgroundColor: 'transparent',
           tooltip: {
             trigger: 'item',
             formatter: '{a} <br/>{b}: {c} ({d}%)',
             backgroundColor: 'rgba(255,255,255,0.95)',
             borderColor: '#e2e8f0',
             textStyle: { color: '#334155' }
           },
           series: [{
             name: '价值评估分布',
            type: 'pie',
            roseType: 'radius',
            radius: ['45%', '75%'],
            center: ['50%', '50%'],
            avoidLabelOverlap: true,
            padAngle: 2,
            itemStyle: {
              borderRadius: 8,
              borderColor: 'rgba(255,255,255,0.8)',
              borderWidth: 2,
              shadowBlur: 5,
              shadowColor: 'rgba(0,0,0,0.08)',
              shadowOffsetY: 2
            },
            label: {
              show: true,
              position: 'outside',
              formatter: function(params) {
                return `{name|${params.name}}\n{value|${params.value}个}`;
              },
              rich: {
                name: {
                  fontSize: 12,
                  fontWeight: '600',
                  color: '#334155',
                  lineHeight: 18
                },
                value: {
                  fontSize: 10,
                  fontWeight: '500',
                  color: '#64748b',
                  lineHeight: 14
                }
              },
              distanceToLabelLine: 5
            },
             emphasis: {
               label: {
                 fontSize: '13',
                 fontWeight: 'bold'
               },
               itemStyle: {
                 shadowBlur: 12,
                 shadowOffsetY: 3,
                 shadowColor: 'rgba(0, 0, 0, 0.15)',
                 borderWidth: 3,
                 borderColor: 'rgba(255,255,255,0.9)'
               },
               scale: true,
               scaleSize: 5
             },
            labelLine: {
              show: true,
              length: 12,
              length2: 8,
              smooth: true,
              lineStyle: {
                color: '#cbd5e1',
                width: 1.8,
                type: 'solid',
                cap: 'round',
                opacity: 0.8
              }
            },
            data: valuationCounts.map(item => ({
              value: item.count,
              name: item.label,
              itemStyle: { color: item.color }
            }))
          }]
        };
        
         chart.setOption(option);
        
        // 使用更安全的resize监听方式
        let valuationResizeTimer;
        const handleValuationResize = () => {
          clearTimeout(valuationResizeTimer);
          valuationResizeTimer = setTimeout(() => {
            if (chart && !chart.isDisposed()) {
              chart.resize();
            }
          }, 100);
        };
        
        window.addEventListener('resize', handleValuationResize, { passive: true });
      }
      
      updateChangeChart() {
        const changeCounts = this.getChangeCounts();
        const chart = echarts.init(document.getElementById('changeChart'));
        
         const option = {
           backgroundColor: 'transparent',
           tooltip: {
             trigger: 'item',
             formatter: '{a} <br/>{b}: {c} ({d}%)',
             backgroundColor: 'rgba(255,255,255,0.95)',
             borderColor: '#e2e8f0',
             textStyle: { color: '#334155' }
           },
           series: [{
             name: '涨跌幅分布',
            type: 'pie',
            roseType: 'radius',
            radius: ['45%', '75%'],
            center: ['50%', '50%'],
            avoidLabelOverlap: true,
            padAngle: 2,
            itemStyle: {
              borderRadius: 8,
              borderColor: 'rgba(255,255,255,0.8)',
              borderWidth: 2,
              shadowBlur: 5,
              shadowColor: 'rgba(0,0,0,0.08)',
              shadowOffsetY: 2
            },
            label: {
              show: true,
              position: 'outside',
              formatter: function(params) {
                return `{name|${params.name}}\n{value|${params.value}个}`;
              },
              rich: {
                name: {
                  fontSize: 12,
                  fontWeight: '600',
                  color: '#334155',
                  lineHeight: 18
                },
                value: {
                  fontSize: 10,
                  fontWeight: '500',
                  color: '#64748b',
                  lineHeight: 14
                }
              },
              distanceToLabelLine: 5
            },
             emphasis: {
               label: {
                 fontSize: '13',
                 fontWeight: 'bold'
               },
               itemStyle: {
                 shadowBlur: 12,
                 shadowOffsetY: 3,
                 shadowColor: 'rgba(0, 0, 0, 0.15)',
                 borderWidth: 3,
                 borderColor: 'rgba(255,255,255,0.9)'
               },
               scale: true,
               scaleSize: 5
             },
            labelLine: {
              show: true,
              length: 12,
              length2: 8,
              smooth: true,
              lineStyle: {
                color: '#cbd5e1',
                width: 1.8,
                type: 'solid',
                cap: 'round',
                opacity: 0.8
              }
            },
            data: changeCounts.map(item => ({
              value: item.count,
              name: item.label,
              itemStyle: { color: item.color }
            }))
          }]
        };
        
         chart.setOption(option);
        
        // 使用更安全的resize监听方式
        let changeResizeTimer;
        const handleChangeResize = () => {
          clearTimeout(changeResizeTimer);
          changeResizeTimer = setTimeout(() => {
            if (chart && !chart.isDisposed()) {
              chart.resize();
            }
          }, 100);
        };
        
        window.addEventListener('resize', handleChangeResize, { passive: true });
      }
      
      getValuationCounts() {
        const counts = {};
        const labels = {
          0: '数据不足',
          1: '数据长久未更新，谨慎使用',
          2: '价值陷阱嫌疑',
          3: '严重低估',
          4: '低估',
          5: '合理范围',
          6: '高估',
          7: '严重高估'
        };
        const colors = {
          0: '#94a3b8',   // 数据不足 - 中性灰
          2: '#ef4444',   // 价值陷阱 - 警告红
          3: '#10b981',   // 严重低估 - 翠绿
          4: '#06d6a0',   // 低估 - 浅绿
          5: '#3b82f6',   // 合理范围 - 蓝色
          6: '#f59e0b',   // 高估 - 橙色
          7: '#dc2626'    // 严重高估 - 深红
        };
        
        this.allData.forEach(item => {
          const val = item.gf_valuation;
          if (!counts[val]) {
            counts[val] = {
              count: 0,
              label: labels[val] || '未知',
              color: colors[val] || '#94a3b8'
            };
          }
          counts[val].count++;
        });
        
         // 固定顺序：严重低估 -> 低估 -> 合理范围 -> 高估 -> 严重高估 -> 价值陷阱嫌疑 -> 数据不足
         const orderedKeys = [3, 4, 5, 6, 7, 2, 0];
         return orderedKeys
           .filter(key => counts[key])
           .map(key => ({
             label: counts[key].label,
             count: counts[key].count,
             color: counts[key].color,
             percentage: ((counts[key].count / this.allData.length) * 100).toFixed(1)
           }));
      }
      
      getChangeCounts() {
        const ranges = [
          { key: 'up5+', label: '上涨5%以上', min: 5, max: Infinity, color: '#e11d48' },
          { key: 'up2-5', label: '上涨2-5%', min: 2, max: 5, color: '#f43f5e' },
          { key: 'up0-2', label: '上涨0-2%', min: 0, max: 2, color: '#fb7185' },
          { key: 'flat', label: '平盘', min: 0, max: 0, color: '#64748b' },
          { key: 'down0-2', label: '下跌0-2%', min: -2, max: 0, color: '#4ade80' },
          { key: 'down2-5', label: '下跌2-5%', min: -5, max: -2, color: '#22c55e' },
          { key: 'down5+', label: '下跌5%以上', min: -Infinity, max: -5, color: '#16a34a' }
        ];
        
        const counts = {};
        ranges.forEach(range => {
          counts[range.key] = { ...range, count: 0 };
        });
        
        this.allData.forEach(item => {
          const change = item.p_pct_change;
          if (change === undefined || change === null) return;
          
          for (const range of ranges) {
            if (change === 0 && range.key === 'flat') {
              counts[range.key].count++;
              break;
            } else if (change > range.min && change <= range.max) {
              counts[range.key].count++;
              break;
            }
          }
        });
        
         // 固定顺序：上涨5%以上 -> 上涨2-5% -> 上涨0-2% -> 平盘 -> 下跌0-2% -> 下跌2-5% -> 下跌5%以上
         const orderedKeys = ['up5+', 'up2-5', 'up0-2', 'flat', 'down0-2', 'down2-5', 'down5+'];
         return orderedKeys
           .filter(key => counts[key] && counts[key].count > 0)
           .map(key => ({
             label: counts[key].label,
             count: counts[key].count,
             color: counts[key].color,
             percentage: ((counts[key].count / this.allData.length) * 100).toFixed(1)
           }));
      }
      
      
      
      formatMarketCap(value) {
        if (!value) return 'N/A';
        
        if (value >= 1e12) {
          return (value / 1e12).toFixed(2) + '万亿';
        } else if (value >= 1e8) {
          return (value / 1e8).toFixed(2) + '亿';
        } else if (value >= 1e4) {
          return (value / 1e4).toFixed(2) + '万';
        }
        return value.toFixed(2);
      }

      formatPrice(price) {
        if (!price) return 'N/A';
        if (typeof price === 'string') {
          // 如果价格已经包含货币符号，直接返回
          if (price.includes('¥') || price.includes('$')) {
            return price;
          }
          // 尝试解析为数字
          const numPrice = parseFloat(price);
          if (isNaN(numPrice)) return price; // 如果解析失败，返回原字符串
          return `¥${numPrice.toFixed(2)}`;
        }
        return `¥${price.toFixed(2)}`;
      }

      formatPE(pe) {
        if (!pe) return 'N/A';
        
        // 转换为数字类型
        const numPE = typeof pe === 'string' ? parseFloat(pe) : pe;
        
        // 检查是否为有效数字
        if (isNaN(numPE) || numPE <= 0) return 'N/A';
        if (numPE > 1000) return '>1000';
        
        return numPE.toFixed(1);
      }

      formatDividendYield(yield_value) {
        if (!yield_value) return 'N/A';
        
        // 转换为数字类型
        const numYield = typeof yield_value === 'string' ? parseFloat(yield_value) : yield_value;
        
        // 检查是否为有效数字
        if (isNaN(numYield) || numYield < 0) return 'N/A';
        
        // 股息率通常以百分比显示，保留2位小数
        return `${numYield.toFixed(2)}%`;
      }

      formatPercentage(value) {
        if (value === undefined || value === null) return 'N/A';
        
        // 转换为数字类型
        const numValue = typeof value === 'string' ? parseFloat(value) : value;
        if (isNaN(numValue)) return 'N/A';
        
        return numValue.toFixed(2) + '%';
      }

      getScoreColor(score) {
        if (!score) return '#94a3b8';
        
        // 转换为数字类型
        const numScore = typeof score === 'string' ? parseFloat(score) : score;
        if (isNaN(numScore)) return '#94a3b8';
        
        if (numScore >= 80) return '#10b981'; // 绿色 - 优秀
        if (numScore >= 60) return '#f59e0b'; // 橙色 - 良好
        if (numScore >= 40) return '#ef4444'; // 红色 - 一般
        return '#6b7280'; // 灰色 - 较差
      }

      truncateText(text, length) {
        if (!text) return 'N/A';
        if (text.length <= length) return text;
        return text.substring(0, length) + '...';
      }
      
      populateIndustryOptions() {
        // 获取所有不重复的行业
        const industries = [...new Set(this.allData.map(item => item.industry).filter(industry => industry))].sort();
        
        // 清空现有选项（除了默认的"所有行业"）
        this.industryFilter.innerHTML = '<option value="">所有行业</option>';
        
        // 添加行业选项
        industries.forEach(industry => {
          const option = document.createElement('option');
          option.value = industry;
          option.textContent = industry;
          this.industryFilter.appendChild(option);
        });
      }
      
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
       updateResultsCount() {
         const total = this.allData.length;
         const filtered = this.filteredData.length;
         const startIndex = (this.currentPage - 1) * this.pageSize + 1;
         const endIndex = Math.min(this.currentPage * this.pageSize, filtered);
         
         if (filtered === 0) {
           this.resultsCount.textContent = `显示 0 / ${total} 条记录`;
         } else {
           this.resultsCount.textContent = `显示 ${startIndex}-${endIndex} / ${filtered} 条记录 (总计 ${total} 条)`;
         }
       }
       
       renderPagination() {
         if (this.totalPages <= 1) {
           this.pagination.style.display = 'none';
           return;
         }
         
         this.pagination.style.display = 'flex';
         
         let paginationHTML = '';
         
         // 上一页按钮
         paginationHTML += `
           <button class="pagination-btn ${this.currentPage === 1 ? 'disabled' : ''}" 
                   onclick="stockFilter.goToPage(${this.currentPage - 1})" 
                   ${this.currentPage === 1 ? 'disabled' : ''}>
             上一页
           </button>
         `;
         
         // 页码按钮
         const maxVisiblePages = 7;
         let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
         let endPage = Math.min(this.totalPages, startPage + maxVisiblePages - 1);
         
         // 调整起始页，确保显示足够的页码
         if (endPage - startPage + 1 < maxVisiblePages) {
           startPage = Math.max(1, endPage - maxVisiblePages + 1);
         }
         
         // 第一页
         if (startPage > 1) {
           paginationHTML += `
             <button class="pagination-btn" onclick="stockFilter.goToPage(1)">1</button>
           `;
           if (startPage > 2) {
             paginationHTML += `<span class="pagination-info">...</span>`;
           }
         }
         
         // 中间页码
         for (let page = startPage; page <= endPage; page++) {
           paginationHTML += `
             <button class="pagination-btn ${page === this.currentPage ? 'active' : ''}" 
                     onclick="stockFilter.goToPage(${page})">
               ${page}
             </button>
           `;
         }
         
         // 最后一页
         if (endPage < this.totalPages) {
           if (endPage < this.totalPages - 1) {
             paginationHTML += `<span class="pagination-info">...</span>`;
           }
           paginationHTML += `
             <button class="pagination-btn" onclick="stockFilter.goToPage(${this.totalPages})">${this.totalPages}</button>
           `;
         }
         
         // 下一页按钮
         paginationHTML += `
           <button class="pagination-btn ${this.currentPage === this.totalPages ? 'disabled' : ''}" 
                   onclick="stockFilter.goToPage(${this.currentPage + 1})" 
                   ${this.currentPage === this.totalPages ? 'disabled' : ''}>
             下一页
           </button>
         `;
         
         // 页面信息
         paginationHTML += `
           <span class="pagination-info">第 ${this.currentPage} / ${this.totalPages} 页</span>
         `;
         
         this.pagination.innerHTML = paginationHTML;
       }
       
       goToPage(page) {
         if (page < 1 || page > this.totalPages || page === this.currentPage) {
           return;
         }
         
         this.currentPage = page;
         this.renderTable();
         this.updateResultsCount();
         this.renderPagination();
         
         // 滚动到表格顶部
         document.querySelector('.table-container').scrollIntoView({ 
           behavior: 'smooth', 
           block: 'start' 
         });
       }
       
       
       
       
        viewStockDetail(row) {
          try {
            // 从data-stockid属性获取股票ID
            const stockid = row.getAttribute('data-stockid');
            if (!stockid) {
              console.error('未找到股票ID');
              return;
            }
            
            // 获取当前选择的日期
            const currentDate = this.dateSelect.value;
            if (!currentDate) {
              console.error('未找到当前日期');
              return;
            }
            
            // 构建详情页面URL，使用stockid和date参数
            const detailUrl = `detail.html?stockid=${encodeURIComponent(stockid)}&date=${encodeURIComponent(currentDate)}`;
            
            // 使用链接方式打开详情页面
            const link = document.createElement('a');
            link.href = detailUrl;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
          } catch (error) {
            console.error('打开股票详情页面失败:', error);
            alert('无法打开股票详情页面');
          }
        }
      
      showLoading(show) {
        this.loadingIndicator.style.display = show ? 'block' : 'none';
      }
      
      showError(message) {
        this.errorMessage.textContent = message;
        this.errorMessage.style.display = 'block';
        
        // 5秒后自动隐藏错误信息
        setTimeout(() => {
          this.errorMessage.style.display = 'none';
        }, 5000);
      }
    }
    
     // 页面加载完成后初始化
     let stockFilter;
     document.addEventListener('DOMContentLoaded', () => {
       stockFilter = new StockDataFilter();
     });
  </script>
</body>
</html>
